<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ŸÖŸÜÿµÿ© ÿßŸÑÿ®ÿØÿßŸäÿ©</title>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- ŸÖŸÉÿ™ÿ®ÿ© ÿßŸÑÿ™ÿßŸäÿ®ŸÜÿ¨ -->
  <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
  <!-- Auth Utility Library (ŸÖŸàÿ≠ÿØ) -->
  <script src="../js/auth.js"></script>

  <style>
    body {
      font-family: 'Cairo', sans-serif;
      transition: background 0.5s ease, color 0.5s ease;
    }
    .animated-bg {
      background: linear-gradient(270deg, #0f172a, #0f172a);
      background-size: 600% 600%;
      animation: gradientShift 18s ease infinite;
    }
    @keyframes gradientShift {
      0%   { background-position: 0% 50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .profile-img {
      transition: all 0.5s ease;
    }
    .profile-img:hover {
      transform: scale(1.05);
      filter: drop-shadow(0 0 25px rgba(59,130,246,0.8));
    }
    .card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }
    .modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.6);
      display: none; justify-content: center; align-items: center;
      z-index: 100;
    }
    .modal-content {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 2rem;
      width: 100%; max-width: 460px;
      color: white;
      transform: scale(0.7);
      opacity: 0;
      transition: all 0.3s ease;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }
    .modal.show .modal-content {
      transform: scale(1);
      opacity: 1;
    }
    
    /* OTP Input Styling */
    .otp-input {
      background: rgba(255, 255, 255, 0.1) !important;
      border: 2px solid rgba(255, 255, 255, 0.2);
      color: white !important;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .otp-input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    }
    
    /* Form Input Styling */
    .modal input {
      background: rgba(255, 255, 255, 0.1) !important;
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
      color: white !important;
    }
    
    .modal select {
      background: white !important;
      color: #374151 !important;
      border: 1px solid #d1d5db;
      transition: all 0.3s ease;
    }
    
    .modal select option {
      background: white !important;
      color: #374151 !important;
      padding: 8px;
    }
    
    .modal select optgroup {
      font-weight: bold;
      padding: 4px;
    }
    
    .modal input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    }
    
    .modal select:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    }
    
    /* Button Styling */
    .modal button[type="submit"] {
      position: relative;
      overflow: hidden;
    }
    .modal button[type="submit"]:before {
      content: '';
      position: absolute;
      top: 0; left: -100%;
      width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    .modal button[type="submit"]:hover:before {
      left: 100%;
    }
    
    /* Loading Animation */
    .loading {
      position: relative;
    }
    .loading:after {
      content: '';
      position: absolute;
      right: 10px; top: 50%;
      transform: translateY(-50%);
      width: 16px; height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top: 2px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: translateY(-50%) rotate(0deg); }
      100% { transform: translateY(-50%) rotate(360deg); }
    }
    
    /* Error and Success Messages */
    .error-message {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      animation: slideInFromTop 0.3s ease;
    }
    .success-message {
      background: linear-gradient(135deg, #10b981, #059669);
      animation: slideInFromTop 0.3s ease;
    }
    
    @keyframes slideInFromTop {
      0% { opacity: 0; transform: translateY(-20px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    
    /* Course Card Hover Effects */
    .course-card {
      cursor: pointer !important;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }
    
    .course-card:hover {
      transform: translateY(-8px) scale(1.02) !important;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4) !important;
    }
    
    .course-card:active {
      transform: translateY(-4px) scale(0.98) !important;
    }
    
    /* Course Access Badges */
    .no-access-badge {
      z-index: 10;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    
    /* Authenticated User Badge */
    .user-badge {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: glow 2s ease-in-out infinite alternate;
    }
    
    @keyframes glow {
      0% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
      100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
    }
    
    /* Enhanced Select Styling */
    .modal select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
      background-position: left 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      padding-left: 2.5rem;
    }
    
    .modal select optgroup {
      background: #f9fafb;
      font-weight: 600;
      font-size: 14px;
    }
    
    .modal select option {
      padding: 8px 12px;
      font-size: 14px;
    }
    
    .modal select option:hover {
      background: #e5e7eb;
    }

    /* Responsive Modal */
    @media (max-width: 640px) {
      .modal-content {
        margin: 1rem;
        max-width: calc(100% - 2rem);
        padding: 1.5rem;
      }
      
      .otp-input {
        width: 2.5rem !important;
        height: 2.5rem !important;
        font-size: 1.2rem !important;
      }
      
      .modal select {
        background-position: left 0.25rem center;
        padding-left: 2rem;
      }
    }
    
    /* Loading States */
    .btn-loading {
      position: relative;
      color: transparent !important;
    }
    
    .btn-loading::after {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      top: 50%;
      left: 50%;
      margin-left: -8px;
      margin-top: -8px;
      border: 2px solid #ffffff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
    }

    /* üåû Light Mode */
    .light-mode {
      background: #f9fafb !important;   /* ÿÆŸÑŸÅŸäÿ© ŸÅÿßÿ™ÿ≠ÿ© */
      color: #1e293b !important;        /* ÿßŸÑŸÜÿµŸàÿµ ÿ∫ÿßŸÖŸÇÿ© */
    }
    .light-mode nav {
      background: #ffffffcc !important;
      color: #1e293b !important;
    }
    .light-mode .card {
      background: #ffffff !important;
      color: #1e293b !important;
      border: 1px solid #e5e7eb;
    }
    .light-mode h1, 
    .light-mode h2, 
    .light-mode h3, 
    .light-mode p {
      color: #1e293b !important;
    }
    .light-mode footer {
      background: #f1f5f9 !important;
      color: #1e293b !important;
    }
    .light-mode .modal-content {
      background: #ffffff !important;
      color: #1e293b !important;
    }
    .light-mode button {
      color: white !important;
    }

    /* Teacher Mode Indicator */
    .teacher-mode-badge {
      background: linear-gradient(135deg, #8b5cf6, #a855f7);
      color: white;
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      box-shadow: 0 2px 4px rgba(139, 92, 246, 0.3);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
  </style>
</head>
<body class="animated-bg text-white">

  <!-- üöÄ Navbar -->
  <nav class="flex items-center justify-between px-4 sm:px-6 py-3 bg-black/40 backdrop-blur-md fixed w-full top-0 z-50">
    <!-- ÿßŸÑÿ¥ÿπÿßÿ± -->
    <div class="flex items-center gap-3">
      <img src="./project 12/images/WhatsApp_Image_2025-09-06_at_00.31.42_7b113d97-removebg-preview.png" alt="ÿ¥ÿπÿßÿ± ÿßŸÑÿ®ÿØÿßŸäÿ©" class="w-10 h-10 sm:w-12 sm:h-12 rounded-full" />
      <span class="text-lg sm:text-xl font-bold">ŸÖŸÜÿµÿ© ÿßŸÑÿ®ÿØÿßŸäÿ©</span>
    </div>

    <!-- ÿßŸÑŸÑŸäŸÜŸÉÿßÿ™ + ÿßŸÑÿßÿ≤ÿ±ÿßÿ± -->
    <div class="hidden md:flex items-center gap-6">
      <a href="#courses" class="hover:text-blue-300">üìö ÿßŸÑŸÉŸàÿ±ÿ≥ÿßÿ™</a>
      <a href="#teacher" class="hover:text-blue-300">üë®‚Äçüè´ ÿßŸÑŸÖÿØÿ±ÿ≥</a>
      <button onclick="toggleTheme()" class="px-3 py-1 bg-white/20 rounded-lg">üåì</button>
      <button id="openLogin" class="px-3 sm:px-4 py-2 bg-blue-600 rounded-lg text-sm sm:text-base">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ</button>
      <button id="openRegister" class="px-3 sm:px-4 py-2 bg-green-600 rounded-lg text-sm sm:text-base">ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®</button>
    </div>

    <!-- ŸÖŸäŸÜŸà ŸÑŸÑŸÖŸàÿ®ÿßŸäŸÑ -->
    <div class="md:hidden">
      <button id="menuToggle" class="px-3 py-2 bg-white/20 rounded-lg">‚ò∞</button>
    </div>
  </nav>

  <!-- ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸàÿ®ÿßŸäŸÑ -->
 <div id="mobileMenu" class="hidden flex-col gap-4 px-6 py-4 bg-black/90 fixed top-14 right-0 w-2/3 h-screen z-40">
  <a href="#courses" class="hover:text-blue-300">üìö ÿßŸÑŸÉŸàÿ±ÿ≥ÿßÿ™</a>
  <a href="#teacher" class="hover:text-blue-300">üë®‚Äçüè´ ÿßŸÑŸÖÿØÿ±ÿ≥</a>
  <button onclick="toggleTheme()" class="px-4 py-2 bg-white/20 rounded-lg">üåì ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸàÿ∂ÿπ</button>
  <button id="openLoginMobile" class="px-4 py-2 bg-blue-600 rounded-lg">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ</button>
  <button id="openRegisterMobile" class="px-4 py-2 bg-green-600 rounded-lg">ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®</button>
</div>

  <!-- üåü Hero Section -->

<header class="h-[90vh] sm:h-screen flex items-center justify-center relative px-4 sm:px-6">
  <div class="absolute inset-0 bg-black/30"></div>
  <div class="relative z-10 grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-10 items-center">
    
    <!-- ÿßŸÑŸÜÿµŸàÿµ -->
    <div class="text-center md:text-right order-2 md:order-1">
      <div class="flex flex-col items-center md:items-start">
        <img src="./project 12/images/WhatsApp_Image_2025-09-06_at_00.31.42_7b113d97-removebg-preview.png" 
             alt="ÿ¥ÿπÿßÿ± ÿßŸÑÿ®ÿØÿßŸäÿ©" 
             class="w-20 h-20 mb-4 rounded-full shadow-lg" />
        <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold mb-4 drop-shadow-lg">
          <span id="typed-text" class="text-blue-400"></span>
        </h1>
      </div>
      <p class="text-base sm:text-lg md:text-xl mt-6 max-w-xl mx-auto md:mx-0">
        ÿ™ÿπŸÑŸÖ ŸÖÿßÿØÿ© ÿßŸÑÿ±Ÿäÿßÿ∂ÿ© ŸÖÿπ ÿßŸÑÿ£ÿ≥ÿ™ÿßÿ∞ ŸÖÿ¨ÿØŸä ÿ¨ŸÖÿßŸÑ - ÿÆÿ®ÿ±ÿ© ŸÅŸä ÿ™ÿØÿ±Ÿäÿ≥ ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ´ÿßŸÜŸàŸäÿ©.
      </p>
    </div>

    <!-- ÿµŸàÿ±ÿ© ÿßŸÑŸÖÿØÿ±ÿ≥ -->
    <div class="flex justify-center order-1 md:order-2">
      <div class="relative">
        <img src="./project 12/images/ÿ™ÿµŸÖŸäŸÖ_ÿ®ÿØŸàŸÜ_ÿπŸÜŸàÿßŸÜ-removebg-preview.png" 
             alt="ÿßŸÑÿ£ÿ≥ÿ™ÿßÿ∞ ŸÖÿ¨ÿØŸä" 
             class="profile-img w-60 sm:w-80 md:w-[420px] rounded-3xl shadow-2xl" />
        
        <!-- Teacher Mode Indicator (Auto based on user role) -->
        <div id="teacherModeIndicator" class="absolute -bottom-4 left-1/2 transform -translate-x-1/2 teacher-mode-badge hidden">
          üë®‚ÄçÔøΩ Ÿàÿ∂ÿπ ÿßŸÑŸÖÿπŸÑŸÖ
        </div>
      </div>
    </div>
  </div>
</header>


  <!-- üë®‚Äçüè´ About Teacher -->
  <section id="teacher" class="py-14 sm:py-20 px-4 sm:px-5 bg-white/10 backdrop-blur-md rounded-3xl shadow-2xl mx-2 sm:mx-4 my-8 sm:my-10">
    <div class="container mx-auto text-center">
      <h2 class="text-3xl sm:text-4xl font-bold mb-6 sm:mb-8 text-white">ÿßŸÑÿ£ÿ≥ÿ™ÿßÿ∞ ŸÖÿ¨ÿØŸä</h2>
      <p class="text-base sm:text-lg mb-6 sm:mb-8 max-w-3xl mx-auto text-gray-200">
                                              ÿßŸÑÿ£ÿ≥ÿ™ÿßÿ∞ ŸÖÿ¨ÿØŸä ÿ¨ŸÖÿßŸÑ ŸáŸà ŸÖÿØÿ±ÿ≥ ŸÖÿßÿØÿ© ÿßŸÑÿ±Ÿäÿßÿ∂ÿ© ÿßŸÑŸÖÿ™ÿÆÿµÿµÿå Ÿäÿ¥ÿ±ÿ≠ ŸÑÿ∑ŸÑÿßÿ® ÿßŸÑÿµŸÅ ÿßŸÑÿ£ŸàŸÑ ŸàÿßŸÑÿ´ÿßŸÜŸä ŸàÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿ´ÿßŸÜŸàŸä ÿ®ÿ£ÿ≥ŸÑŸàÿ® Ÿàÿßÿ∂ÿ≠ ŸàŸÖŸÖÿ™ÿπ Ÿäÿ≥ÿßÿπÿØ ÿπŸÑŸâ ÿßŸÑŸÅŸáŸÖ ÿßŸÑÿ≥ŸáŸÑ ŸàÿßŸÑÿ™ŸÅŸàŸÇ ŸÉŸÖÿß ŸÇÿßŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿ± ÿßŸÑŸàÿßÿ≠ÿØ ŸÖŸÜŸÜÿß ÿ®ÿßŸÑŸÅ .
      </p>
      <img src="./project 12/images/photo_2025-09-03_00-20-27.jpg" alt="ÿµŸàÿ±ÿ© ÿßŸÑÿ£ÿ≥ÿ™ÿßÿ∞ ŸÖÿ¨ÿØŸä" class="profile-img mx-auto w-32 sm:w-44" />
    </div>
  </section>

  <!-- üìö Courses -->
  <section id="courses" class="py-14 sm:py-20 px-4 sm:px-5 bg-gradient-to-r from-blue-500 to-teal-500">
    <div class="container mx-auto">
      <h2 class="text-3xl sm:text-4xl font-bold text-center mb-8 sm:mb-10">üìö ÿßŸÑŸÉŸàÿ±ÿ≥ÿßÿ™ ÿßŸÑÿ™ÿπŸÑŸäŸÖŸäÿ©</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-6 sm:gap-8">

        <div class="card course-card bg-white text-gray-800 p-6 rounded-xl shadow-lg flex flex-col items-center">
          <img src="./project 12/images/photo_2025-09-03_23-36-50.jpg" alt="ÿßŸÑÿµŸÅ ÿßŸÑÿ£ŸàŸÑ" class="w-24 h-24 mb-4 rounded-full shadow-md object-cover" />
          <h3 class="text-xl sm:text-2xl font-semibold mb-2">ÿßŸÑÿµŸÅ ÿßŸÑÿ£ŸàŸÑ ÿßŸÑÿ´ÿßŸÜŸàŸä</h3>
          <p class="text-center">ÿØÿ±Ÿàÿ≥ ÿ™ÿ£ÿ≥Ÿäÿ≥Ÿäÿ© ÿ¥ÿßŸÖŸÑÿ© ŸÅŸä ÿßŸÑÿ±Ÿäÿßÿ∂ÿ©.</p>
        </div>

        <div class="card course-card bg-white text-gray-800 p-6 rounded-xl shadow-lg flex flex-col items-center">
          <img src="./project 12/images/photo_2025-09-03_23-53-13.jpg" alt="ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä ÿπŸÑŸÖŸä" class="w-24 h-24 mb-4 rounded-full shadow-md object-cover" />
          <h3 class="text-xl sm:text-2xl font-semibold mb-2">ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä - ÿπŸÑŸÖŸä</h3>
          <p class="text-center">ÿ±Ÿäÿßÿ∂ÿ© ŸÖÿ™ŸÇÿØŸÖÿ© ŸÑŸÑÿ¥ÿπÿ®ÿ© ÿßŸÑÿπŸÑŸÖŸäÿ©.</p>
        </div>

        <div class="card course-card bg-white text-gray-800 p-6 rounded-xl shadow-lg flex flex-col items-center">
          <img src="./project 12/images/photo_2025-09-03_23-53-13.jpg" alt="ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä ÿ£ÿØÿ®Ÿä" class="w-24 h-24 mb-4 rounded-full shadow-md object-cover" />
          <h3 class="text-xl sm:text-2xl font-semibold mb-2">ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä - ÿ£ÿØÿ®Ÿä</h3>
          <p class="text-center">ÿ±Ÿäÿßÿ∂ÿ© ÿßŸÑÿ¥ÿπÿ®ÿ© ÿßŸÑÿ£ÿØÿ®Ÿäÿ© ÿßŸÑŸÖÿ®ÿ≥ÿ∑ÿ©.</p>
        </div>

        <div class="card course-card bg-white text-gray-800 p-6 rounded-xl shadow-lg flex flex-col items-center">
          <img src="./project 12/images/photo_2025-09-03_23-53-17.jpg" alt="ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿπŸÑŸÖŸä" class="w-24 h-24 mb-4 rounded-full shadow-md object-cover" />
          <h3 class="text-xl sm:text-2xl font-semibold mb-2">ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ - ÿπŸÑŸÖŸä</h3>
          <p class="text-center">ŸÖÿ±ÿßÿ¨ÿπÿ© ŸÜŸáÿßÿ¶Ÿäÿ© Ÿàÿ™ÿ≠ÿ∂Ÿäÿ± ŸÑŸÑÿ´ÿßŸÜŸàŸäÿ© ÿßŸÑÿπÿßŸÖÿ© - ÿßŸÑÿ¥ÿπÿ®ÿ© ÿßŸÑÿπŸÑŸÖŸäÿ©.</p>
        </div>

        <div class="card course-card bg-white text-gray-800 p-6 rounded-xl shadow-lg flex flex-col items-center">
          <img src="./project 12/images/photo_2025-09-03_23-53-16.jpg" alt="ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿ£ÿØÿ®Ÿä" class="w-24 h-24 mb-4 rounded-full shadow-md object-cover" />
          <h3 class="text-xl sm:text-2xl font-semibold mb-2">ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ - ÿ£ÿØÿ®Ÿä</h3>
          <p class="text-center">ŸÖÿ±ÿßÿ¨ÿπÿ© ŸÜŸáÿßÿ¶Ÿäÿ© Ÿàÿ™ÿ≠ÿ∂Ÿäÿ± ŸÑŸÑÿ´ÿßŸÜŸàŸäÿ© ÿßŸÑÿπÿßŸÖÿ© - ÿßŸÑÿ¥ÿπÿ®ÿ© ÿßŸÑÿ£ÿØÿ®Ÿäÿ©.</p>
        </div>

      </div>
    </div>
  </section>

  <!-- üì© Footer -->
  <footer class="bg-gray-900 text-white py-10 text-center px-4">
    <p>¬© 2025 ŸÖŸÜÿµÿ© ÿßŸÑÿ®ÿØÿßŸäÿ© ŸÑŸÑÿ™ÿπŸÑŸÖ ÿßŸÑÿ±Ÿäÿßÿ∂Ÿä. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©.</p>
    <p class="mt-2">üìß ÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÜÿß: info@magdijamal-sport.com</p>
  </footer>

  <!-- üîë Login Modal -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</h2>
        <button onclick="closeModal('loginModal')" class="text-2xl hover:text-red-500">‚úñÔ∏è</button>
      </div>
      
      <!-- ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿ∑ÿ£ -->
      <div id="loginErrors" class="mb-4 p-3 bg-red-500/20 text-red-300 rounded-lg hidden"></div>
      <div id="loginSuccess" class="mb-4 p-3 bg-green-500/20 text-green-300 rounded-lg hidden"></div>
      
      <form id="loginForm" class="flex flex-col gap-4">
        <input type="email" id="loginEmail" name="email" placeholder="ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä" required class="p-3 rounded bg-white/20 placeholder-gray-300" />
        <input type="password" id="loginPassword" name="password" placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" required class="p-3 rounded bg-white/20 placeholder-gray-300" />
        
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-bold transition-colors duration-300" id="loginBtn">
          ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
        </button>
        
        <button type="button" onclick="openForgotPasswordModal()" class="text-blue-400 hover:text-blue-300 text-sm underline">
          ŸÜÿ≥Ÿäÿ™ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±ÿü
        </button>
        
        <p class="text-sm text-center text-gray-300">
          ŸÑŸäÿ≥ ŸÑÿØŸäŸÉ ÿ≠ÿ≥ÿßÿ®ÿü 
          <button type="button" onclick="closeModal('loginModal'); openModal('registerModal')" class="text-green-400 hover:text-green-300 underline">
            ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ
          </button>
        </p>
      </form>
    </div>
  </div>

  <!-- üÜï Signup Modal -->
  <div id="registerModal" class="modal">
    <div class="modal-content max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold">ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ</h2>
        <button onclick="closeModal('registerModal')" class="text-2xl hover:text-red-500">‚úñÔ∏è</button>
      </div>
      
      <!-- ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿ∑ÿ£ -->
      <div id="registerErrors" class="mb-4 p-3 bg-red-500/20 text-red-300 rounded-lg hidden"></div>
      <div id="registerSuccess" class="mb-4 p-3 bg-green-500/20 text-green-300 rounded-lg hidden"></div>
      
      <form id="signupForm" class="flex flex-col gap-4">
        <input type="text" id="fullName" name="fullName" placeholder="ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ±ÿ®ÿßÿπŸä ŸÉÿßŸÖŸÑÿßŸã (ŸÖÿ´ÿßŸÑ: ÿ£ÿ≠ŸÖÿØ ŸÖÿ≠ŸÖÿØ ÿπŸÑŸä ÿßŸÑÿ≥ŸäÿØ)" required minlength="10" maxlength="100" class="p-3 rounded bg-white/20 placeholder-gray-300" />
        <div id="fullNameIndicator" class="mt-1 text-xs text-white/70 hidden">
          <span id="nameCount">0/100 ÿ≠ÿ±ŸÅ</span>
        </div>
        
        <input type="email" id="signupEmail" name="email" placeholder="ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä" required class="p-3 rounded bg-white/20 placeholder-gray-300" />
        <input type="password" id="signupPassword" name="password" placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± (8 ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ)" required class="p-3 rounded bg-white/20 placeholder-gray-300" />
        
        <select id="location" name="location" required class="p-3 rounded bg-white text-gray-800 border border-gray-300">
          <option value="" disabled selected>ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸÉÿßŸÜ</option>
          <option value="ÿßŸÑÿπÿ≥Ÿäÿ±ÿßÿ™">ÿßŸÑÿπÿ≥Ÿäÿ±ÿßÿ™</option>
          <option value="ÿßŸÑŸÖŸÜÿ¥ÿßÿ©">ÿßŸÑŸÖŸÜÿ¥ÿßÿ©</option>
          <option value="ÿßŸÑÿßÿ¨ÿßŸäŸàŸá">ÿßŸÑÿßÿ¨ÿßŸäŸàŸá</option>
        </select>
        
        <select id="signupGrade" name="grade" required class="p-3 rounded bg-white text-gray-800 border border-gray-300">
          <option value="" disabled selected>ÿßÿÆÿ™ÿ± ÿßŸÑÿµŸÅ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä</option>
          <optgroup label="ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ´ÿßŸÜŸàŸäÿ©" class="bg-purple-50">
            <option value="ÿßŸÑÿµŸÅ ÿßŸÑÿ£ŸàŸÑ ÿßŸÑÿ´ÿßŸÜŸàŸä">ÿßŸÑÿµŸÅ ÿßŸÑÿ£ŸàŸÑ ÿßŸÑÿ´ÿßŸÜŸàŸä</option>
            <option value="ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä ÿßŸÑÿ´ÿßŸÜŸàŸä ÿπŸÑŸÖŸä">ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä ÿßŸÑÿ´ÿßŸÜŸàŸä ÿπŸÑŸÖŸä</option>
            <option value="ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä ÿßŸÑÿ´ÿßŸÜŸàŸä ÿßÿØÿ®Ÿä">ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä ÿßŸÑÿ´ÿßŸÜŸàŸä ÿßÿØÿ®Ÿä</option>
            <option value="ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿ´ÿßŸÜŸàŸä ÿπŸÑŸÖŸä">ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿ´ÿßŸÜŸàŸä ÿπŸÑŸÖŸä</option>
            <option value="ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿ´ÿßŸÜŸàŸä ÿßÿØÿ®Ÿä">ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿ´ÿßŸÜŸàŸä ÿßÿØÿ®Ÿä</option>
          </optgroup>
        </select>
        
        <input type="tel" id="phone" name="phone" placeholder="ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)" class="p-3 rounded bg-white/20 placeholder-gray-300" />
        
        <button type="submit" class="bg-green-600 hover:bg-green-700 py-3 rounded-lg font-bold transition-colors duration-300" id="registerBtn">
          ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ®
        </button>
        
        <p class="text-sm text-center text-gray-300">
          ŸáŸÑ ŸÑÿØŸäŸÉ ÿ≠ÿ≥ÿßÿ® ÿ®ÿßŸÑŸÅÿπŸÑÿü 
          <button type="button" onclick="closeModal('registerModal'); openModal('loginModal')" class="text-blue-400 hover:text-blue-300 underline">
            ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
          </button>
        </p>
      </form>
    </div>
  </div>

  <!-- üì± OTP Verification Modal -->
  <div id="otpModal" class="modal">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold">ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ≠ÿ≥ÿßÿ®</h2>
        <button onclick="closeModal('otpModal')" class="text-2xl hover:text-red-500">‚úñÔ∏è</button>
      </div>
      
      <div class="text-center mb-6">
        <p class="text-gray-300 mb-2">ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ŸÖÿ≤ ÿßŸÑÿ™ŸÅÿπŸäŸÑ ÿ•ŸÑŸâ ÿ®ÿ±ŸäÿØŸÉ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä</p>
        <p class="text-blue-400 font-semibold" id="otpEmailDisplay"></p>
      </div>
      
      <!-- ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿ∑ÿ£ -->
      <div id="otpErrors" class="mb-4 p-3 bg-red-500/20 text-red-300 rounded-lg hidden"></div>
      <div id="otpSuccess" class="mb-4 p-3 bg-green-500/20 text-green-300 rounded-lg hidden"></div>
      
      <form id="otpForm" class="flex flex-col gap-4">
        <div class="flex justify-center gap-2 mb-4">
          <input type="text" class="otp-input w-12 h-12 text-center text-2xl bg-white/20 rounded-lg" maxlength="1" />
          <input type="text" class="otp-input w-12 h-12 text-center text-2xl bg-white/20 rounded-lg" maxlength="1" />
          <input type="text" class="otp-input w-12 h-12 text-center text-2xl bg-white/20 rounded-lg" maxlength="1" />
          <input type="text" class="otp-input w-12 h-12 text-center text-2xl bg-white/20 rounded-lg" maxlength="1" />
          <input type="text" class="otp-input w-12 h-12 text-center text-2xl bg-white/20 rounded-lg" maxlength="1" />
          <input type="text" class="otp-input w-12 h-12 text-center text-2xl bg-white/20 rounded-lg" maxlength="1" />
        </div>
        
        <button type="submit" class="bg-green-600 hover:bg-green-700 py-3 rounded-lg font-bold transition-colors duration-300" id="verifyOtpBtn">
          ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ≠ÿ≥ÿßÿ®
        </button>
        
        <div class="text-center">
          <p class="text-sm text-gray-300 mb-2">ŸÑŸÖ ÿ™ÿ≥ÿ™ŸÑŸÖ ÿßŸÑÿ±ŸÖÿ≤ÿü</p>
          <button type="button" onclick="resendOTP()" class="text-blue-400 hover:text-blue-300 text-sm underline" id="resendOtpBtn">
            ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ
          </button>
          <span id="resendTimer" class="text-sm text-gray-400 ml-2"></span>
        </div>
      </form>
    </div>
  </div>

  <!-- üîí Forgot Password Modal -->
  <div id="forgotPasswordModal" class="modal">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold">ÿßÿ≥ÿ™ÿπÿßÿØÿ© ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</h2>
        <button onclick="closeModal('forgotPasswordModal')" class="text-2xl hover:text-red-500">‚úñÔ∏è</button>
      </div>
      
      <p class="text-gray-300 mb-4 text-center">
        ÿ£ÿØÿÆŸÑ ÿ®ÿ±ŸäÿØŸÉ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä Ÿàÿ≥ŸÜÿ±ÿ≥ŸÑ ŸÑŸÉ ÿ±ÿßÿ®ÿ∑ ÿßÿ≥ÿ™ÿπÿßÿØÿ© ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
      </p>
      
      <!-- ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿ∑ÿ£ -->
      <div id="forgotPasswordErrors" class="mb-4 p-3 bg-red-500/20 text-red-300 rounded-lg hidden"></div>
      <div id="forgotPasswordSuccess" class="mb-4 p-3 bg-green-500/20 text-green-300 rounded-lg hidden"></div>
      
      <form id="forgotPasswordForm" class="flex flex-col gap-4">
        <input type="email" id="forgotEmail" name="email" placeholder="ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä" required class="p-3 rounded bg-white/20 placeholder-gray-300" />
        
        <button type="submit" class="bg-purple-600 hover:bg-purple-700 py-3 rounded-lg font-bold transition-colors duration-300" id="forgotPasswordBtn">
          ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿßÿ≥ÿ™ÿπÿßÿØÿ©
        </button>
        
        <button type="button" onclick="closeModal('forgotPasswordModal'); openModal('loginModal')" class="text-blue-400 hover:text-blue-300 text-sm underline">
          ÿßŸÑÿπŸàÿØÿ© ŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
        </button>
      </form>
    </div>
  </div>

  <!-- üîÑ Reset Password Modal -->
  <div id="resetPasswordModal" class="modal">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold">ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ÿ¨ÿØŸäÿØÿ©</h2>
        <button onclick="closeModal('resetPasswordModal')" class="text-2xl hover:text-red-500">‚úñÔ∏è</button>
      </div>
      
      <!-- ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿ∑ÿ£ -->
      <div id="resetPasswordErrors" class="mb-4 p-3 bg-red-500/20 text-red-300 rounded-lg hidden"></div>
      <div id="resetPasswordSuccess" class="mb-4 p-3 bg-green-500/20 text-green-300 rounded-lg hidden"></div>
      
      <form id="resetPasswordForm" class="flex flex-col gap-4">
        <input type="password" id="newPassword" name="newPassword" placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ© (8 ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ)" required class="p-3 rounded bg-white/20 placeholder-gray-300" />
        <input type="password" id="confirmNewPassword" name="confirmNewPassword" placeholder="ÿ™ÿ£ŸÉŸäÿØ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©" required class="p-3 rounded bg-white/20 placeholder-gray-300" />
        
        <button type="submit" class="bg-green-600 hover:bg-green-700 py-3 rounded-lg font-bold transition-colors duration-300" id="resetPasswordBtn">
          ÿ≠ŸÅÿ∏ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©
        </button>
      </form>
    </div>
  </div>

  <!-- ‚ö° Scripts -->
  <script>
    // ============= Configuration & Constants =============
    const API_BASE_URL = 'https://courses-pj.vercel.app/api';
    const TEST_MODE = false; // Set to true for testing without backend
    
    let resendTimer = 0;
    let resendInterval;

    // ============= Form Validation Functions =============
    
    // Validate email format
    function validateEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }
    
    // Validate password strength
    function validatePassword(password) {
      return password.length >= 8 && 
             /[A-Z]/.test(password) && 
             /[a-z]/.test(password) && 
             /\d/.test(password);
    }
    
    // Validate Arabic/English names (2-20 characters)
    function validateName(name) {
      const nameRegex = /^[\u0621-\u064A\u0660-\u0669a-zA-Z\s]{2,20}$/;
      return nameRegex.test(name.trim());
    }
    
    // Validate Egyptian phone number
    function validatePhone(phone) {
      if (!phone) return true; // Optional field
      const phoneRegex = /^(010|011|012|015)\d{8}$/;
      return phoneRegex.test(phone.replace(/\s|-/g, ''));
    }
    
    // Validate full name according to backend requirements
    function validateFullName(fullName) {
      if (!fullName || typeof fullName !== 'string') {
        return false;
      }
      
      const trimmedName = fullName.trim();
      
      // Check length (10-100 characters)
      if (trimmedName.length < 10 || trimmedName.length > 100) {
        return false;
      }
      
      // Check that it contains only letters and spaces (Arabic or English)
      const nameRegex = /^[\u0621-\u064A\u0660-\u0669a-zA-Z\s]+$/;
      if (!nameRegex.test(trimmedName)) {
        return false;
      }
      
      // Check that it contains at least 3 separate names
      const names = trimmedName.split(/\s+/).filter(name => name.length > 0);
      if (names.length < 3) {
        return false;
      }
      
      // Check each name part (at least 2 characters each)
      return names.every(name => name.length >= 2);
    }
    
    // Split full name into parts
    function splitFullName(fullName) {
      if (!fullName || typeof fullName !== 'string') {
        console.error('Invalid fullName provided:', fullName);
        return {
          firstName: '',
          secondName: '',
          thirdName: '',
          fourthName: ''
        };
      }
      
      const names = fullName.trim().split(/\s+/).filter(name => name.length > 0);
      return {
        firstName: names[0] || '',
        secondName: names[1] || '',
        thirdName: names[2] || '',
        fourthName: names[3] || names[2] || '' // If only 3 names, use third as fourth
      };
    }

    // Validate registration form
    function validateRegistrationForm(formData) {
      console.log('üîç ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ...');
      const errors = [];
      
      const fullName = formData.get('fullName');
      const email = formData.get('email');
      const password = formData.get('password');
      const location = formData.get('location');
      const grade = formData.get('grade');
      const phone = formData.get('phone');
      
      console.log('üìù ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖÿ©:', {
        fullName: fullName ? `"${fullName.substring(0, 30)}" (${fullName.length} ÿ≠ÿ±ŸÅ)` : 'ŸÅÿßÿ±ÿ∫',
        email: email || 'ŸÅÿßÿ±ÿ∫',
        phone: phone || 'ŸÅÿßÿ±ÿ∫',
        location: location || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ',
        grade: grade || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'
      });
      
      // Validate full name with detailed logging
      console.log('üî§ ŸÅÿ≠ÿµ ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ±ÿ®ÿßÿπŸä...');
      if (!fullName || !fullName.trim()) {
        console.log('‚ùå ÿßŸÑÿßÿ≥ŸÖ ŸÅÿßÿ±ÿ∫');
        errors.push('ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ±ÿ®ÿßÿπŸä ŸÖÿ∑ŸÑŸàÿ®');
      } else {
        const nameLength = fullName.trim().length;
        const isNameValid = validateFullName(fullName);
        console.log(`üìè ÿ∑ŸàŸÑ ÿßŸÑÿßÿ≥ŸÖ: ${nameLength}ÿå ÿµÿ≠Ÿäÿ≠: ${isNameValid}`);
        
        if (nameLength < 10) {
          errors.push(`ÿßŸÑÿßÿ≥ŸÖ ŸÇÿµŸäÿ± ÿ¨ÿØÿßŸã - ÿ£ÿØÿÆŸÑ ${10 - nameLength} ÿ≠ÿ±ŸÅ ÿ•ÿ∂ÿßŸÅŸä ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ`);
        } else if (nameLength > 100) {
          errors.push(`ÿßŸÑÿßÿ≥ŸÖ ÿ∑ŸàŸäŸÑ ÿ¨ÿØÿßŸã - ÿßÿ≠ÿ∞ŸÅ ${nameLength - 100} ÿ≠ÿ±ŸÅ`);
        } else if (!isNameValid) {
          const nameParts = fullName.trim().split(/\s+/).filter(part => part.length > 0);
          console.log(`üî¢ ÿπÿØÿØ ÿ£ÿ¨ÿ≤ÿßÿ° ÿßŸÑÿßÿ≥ŸÖ: ${nameParts.length}`);
          if (nameParts.length < 3) {
            errors.push(`Ÿäÿ¨ÿ® ÿ•ÿØÿÆÿßŸÑ 3 ÿ£ÿ≥ŸÖÿßÿ° ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ ŸÖŸÅÿµŸàŸÑÿ© ÿ®ŸÖÿ≥ÿßŸÅÿßÿ™ (ŸÑÿØŸäŸÉ ${nameParts.length} ŸÅŸÇÿ∑)`);
          }
        }
      }
      
      if (!validateEmail(email)) {
        errors.push('ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠');
      }
      if (!validatePassword(password)) {
        errors.push('ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ÿ≠ÿ™ŸàŸä ÿπŸÑŸâ 8 ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ ŸÖÿπ ÿ≠ÿ±ŸÅ ŸÉÿ®Ÿäÿ± Ÿàÿµÿ∫Ÿäÿ± Ÿàÿ±ŸÇŸÖ');
      }
      if (!location) {
        errors.push('Ÿäÿ¨ÿ® ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖŸÉÿßŸÜ');
      }
      if (!grade) {
        errors.push('Ÿäÿ¨ÿ® ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä');
      }
      if (phone && phone.trim() && !validatePhone(phone)) {
        errors.push('ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ (Ÿäÿ¨ÿ® ÿ£ŸÜ Ÿäÿ®ÿØÿ£ ÿ®ŸÄ 010, 011, 012, ÿ£Ÿà 015)');
      }
      
      console.log(errors.length === 0 ? '‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿµÿ≠Ÿäÿ≠ÿ©!' : '‚ùå ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑŸÖŸàÿ¨ŸàÿØÿ©:', errors);
      return errors;
    }
    
    // Validate login form
    function validateLoginForm(email, password) {
      const errors = [];
      
      if (!validateEmail(email)) {
        errors.push('ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠');
      }
      if (!password || password.length < 8) {
        errors.push('ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ 8 ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ');
      }
      
      return errors;
    }

    // ============= Authentication Utility Functions =============
    
    // Get auth token from localStorage
    function getAuthToken() {
      return localStorage.getItem('authToken');
    }
    
    // Get user data from localStorage
    function getCurrentUser() {
      const userStr = localStorage.getItem('user');
      return userStr ? JSON.parse(userStr) : null;
    }
    
    // Check if user is logged in
    function isLoggedIn() {
      return getAuthToken() && getCurrentUser();
    }
    
    // Save user session
    function saveUserSession(token, user) {
      localStorage.setItem('authToken', token);
      localStorage.setItem('user', JSON.stringify(user));
    }
    
    // Clear user session
    function clearUserSession() {
      localStorage.removeItem('authToken');
      localStorage.removeItem('user');
      localStorage.removeItem('tempToken');
      localStorage.removeItem('userEmail');
    }
    
    // Show loading state
    function showLoading(buttonId, text = 'ÿ¨ÿßÿ±Ÿä ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©...') {
      const button = document.getElementById(buttonId);
      button.innerHTML = text;
      button.disabled = true;
    }
    
    // Hide loading state
    function hideLoading(buttonId, originalText) {
      const button = document.getElementById(buttonId);
      button.innerHTML = originalText;
      button.disabled = false;
    }
    
    // Show error message
    function showError(containerId, message) {
      const container = document.getElementById(containerId);
      container.innerHTML = message;
      container.classList.remove('hidden');
      setTimeout(() => container.classList.add('hidden'), 5000);
    }
    
    // Show success message
    function showSuccess(containerId, message) {
      const container = document.getElementById(containerId);
      container.innerHTML = message;
      container.classList.remove('hidden');
      setTimeout(() => container.classList.add('hidden'), 5000);
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Page loaded, initializing...');
      
      updateGlobalModeDisplay();
      checkAuthState();
      setupEventListeners();
      addCourseCardHandlers();
      // ÿ∂ŸÖÿßŸÜ ÿ±ÿ®ÿ∑ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÅŸàÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
      if (typeof attachAuthButtonHandlers === 'function') {
        attachAuthButtonHandlers();
      }
      
      // Update course visibility after auth state is checked
      setTimeout(updateCourseVisibility, 100);
      
      console.log('Event listeners set up');
      
      // Typed effect
      new Typed('#typed-text', {
        strings: ['üöÄ ŸÖŸÜÿµÿ© ÿßŸÑÿ®ÿØÿßŸäÿ©', '‚ú® ŸÖÿ≥ÿ™ŸÇÿ®ŸÑŸÉ Ÿäÿ®ÿØÿ£ ŸÖŸÜ ŸáŸÜÿß', 'üìö ÿ™ÿπŸÑŸÖ Ÿàÿ™ŸÅŸàŸÇ ŸÖÿπ ÿßŸÑÿ®ÿØÿßŸäÿ©'],
        typeSpeed: 60,
        backSpeed: 40,
        loop: true
      });

      // Check for reset password token in URL
      const urlParams = new URLSearchParams(window.location.search);
      const resetToken = urlParams.get('reset-token');
      if (resetToken) {
        localStorage.setItem('resetToken', resetToken);
        openModal('resetPasswordModal');
      }
    });

    // ============= Authentication Functions =============
    
    // Register new user
    async function registerUser(formData) {
      // Debug: Log form data
      console.log('Form Data received:', formData);
      for (let pair of formData.entries()) {
        console.log(pair[0] + ': ' + pair[1]);
      }
      
      // Client-side validation
      const validationErrors = validateRegistrationForm(formData);
      if (validationErrors.length > 0) {
        showError('registerErrors', validationErrors.join('<br>'));
        return;
      }
      
      showLoading('registerBtn', 'ÿ¨ÿßÿ±Ÿä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ®...');
      
      const fullName = formData.get('fullName');
      
      // Additional validation
      if (!fullName) {
        showError('registerErrors', 'ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ±ÿ®ÿßÿπŸä ŸÖÿ∑ŸÑŸàÿ®');
        return;
      }
      
      // Validate full name using existing validation function
      if (!validateFullName(fullName)) {
        showError('registerErrors', 'Ÿäÿ¨ÿ® ÿ•ÿØÿÆÿßŸÑ ÿßÿ≥ŸÖ ÿ±ÿ®ÿßÿπŸä ÿµÿ≠Ÿäÿ≠ (3 ÿ£ÿ≥ŸÖÿßÿ° ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑÿå 10-100 ÿ≠ÿ±ŸÅ)');
        return;
      }
      
      const userData = {
        name: fullName.trim(), // Send full name as single field
        email: formData.get('email'),
        password: formData.get('password'),
        location: formData.get('location'),
        grade: formData.get('grade'),
        role: 'student' // Always student as requested
      };

      // Add phone number only if provided
      const phoneNumber = formData.get('phone');
      if (phoneNumber && phoneNumber.trim()) {
        userData.phoneNumber = phoneNumber.trim();
      }
      
      // Clean up userData - remove undefined values
      Object.keys(userData).forEach(key => {
        if (userData[key] === undefined) {
          delete userData[key];
        }
      });

      console.log('üì§ User data to be sent:', userData);
      console.log('üìù Form data details:', {
        name: `"${userData.name}" (${userData.name?.length} ÿ≠ÿ±ŸÅ)`,
        email: userData.email,
        password: userData.password ? `${userData.password.length} ÿ≠ÿ±ŸÅ` : 'ŸÅÿßÿ±ÿ∫',
        phoneNumber: userData.phoneNumber || 'ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±',
        location: userData.location,
        grade: userData.grade
      });

      try {
        if (TEST_MODE) {
          // Test mode - simulate successful registration
          console.log('TEST MODE: Simulating successful registration');
          showSuccess('registerSuccess', 'ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿ®ŸÜÿ¨ÿßÿ≠ (Ÿàÿ∂ÿπ ÿßÿÆÿ™ÿ®ÿßÿ±)');
          setTimeout(() => {
            closeModal('registerModal');
            openOtpModal(userData.email);
          }, 1500);
          return;
        }
        
        console.log('Sending request to:', `${API_BASE_URL}/users/`);
        console.log('Request payload:', JSON.stringify(userData));
        
        const response = await fetch(`${API_BASE_URL}/users/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(userData)
        });
        
        console.log('Response status:', response.status);
        console.log('Response headers:', response.headers);
        
        const result = await response.json();
        console.log('üì• Response data:', result);
        
        if (response.ok) {
          // Success - store temp token and show OTP modal
          console.log('‚úÖ Registration successful!');
          localStorage.setItem('tempToken', result.tempToken);
          localStorage.setItem('userEmail', result.user.email);
          
          showSuccess('registerSuccess', result.message);
          setTimeout(() => {
            closeModal('registerModal');
            openOtpModal(result.user.email);
          }, 1500);
        } else {
          // Handle errors
          console.log('‚ùå Registration failed with status:', response.status);
          if (result.errors && Array.isArray(result.errors)) {
            console.log('üö´ Server validation errors:', result.errors);
            const errorMessages = result.errors
              .map(error => `‚Ä¢ ${error.msg}`)
              .join('<br>');
            showError('registerErrors', `ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™:<br>${errorMessages}`);
          } else {
            showError('registerErrors', result.message);
          }
        }
      } catch (error) {
        console.error('Registration error:', error);
        
        if (error.name === 'TypeError' && error.message.includes('fetch')) {
          showError('registerErrors', 'ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿÆÿßÿØŸÖ. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®ÿßŸÉ ÿ•ŸÜÿØ ÿπŸÑŸâ https://courses-pj.vercel.app');
        } else {
          showError('registerErrors', `ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ: ${error.message}`);
        }
      } finally {
        hideLoading('registerBtn', 'ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ®');
      }
    }

    // Login user
    async function loginUser(email, password) {
      console.log('Login attempt:', { email }); // Don't log password
      
      // Client-side validation
      const validationErrors = validateLoginForm(email, password);
      if (validationErrors.length > 0) {
        showError('loginErrors', validationErrors.join('<br>'));
        return;
      }
      
      showLoading('loginBtn', 'ÿ¨ÿßÿ±Ÿä ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ...');
      
      try {
        const response = await fetch(`${API_BASE_URL}/users/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email, password })
        });
        
        const result = await response.json();
        
        if (response.ok) {
          // Success - save session and redirect
          saveUserSession(result.token, result.user);
          showSuccess('loginSuccess', result.message);
          
          setTimeout(() => {
            closeModal('loginModal');
            updateNavbar();
            showNotification('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠! üéâ', 'success');
          }, 1500);
          
        } else if (response.status === 403 && result.requiresVerification) {
          // Account not verified - show OTP modal
          localStorage.setItem('userEmail', result.userEmail);
          closeModal('loginModal');
          openOtpModal(result.userEmail);
          showError('otpErrors', 'Ÿäÿ¨ÿ® ÿ™ŸÅÿπŸäŸÑ ÿ≠ÿ≥ÿßÿ®ŸÉ ÿ£ŸàŸÑÿßŸã');
          
        } else {
          showError('loginErrors', result.message);
        }
      } catch (error) {
        console.error('Login error:', error);
        showError('loginErrors', 'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ. ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
      } finally {
        hideLoading('loginBtn', 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ');
      }
    }

    // Verify OTP
    async function verifyOTP(email, otp) {
      showLoading('verifyOtpBtn', 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÇŸÇ...');
      
      try {
        const response = await fetch(`${API_BASE_URL}/users/verify-otp`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email, otp })
        });
        
        const result = await response.json();
        
        if (response.ok) {
          // Success - save permanent token
          saveUserSession(result.token, result.user);
          showSuccess('otpSuccess', result.message);
          
          setTimeout(() => {
            closeModal('otpModal');
            updateNavbar();
            showNotification('ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿ≠ÿ≥ÿßÿ®ŸÉ ÿ®ŸÜÿ¨ÿßÿ≠! üéâ', 'success');
          }, 1500);
          
        } else {
          showError('otpErrors', result.message);
        }
      } catch (error) {
        console.error('OTP verification error:', error);
        showError('otpErrors', 'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ. ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
      } finally {
        hideLoading('verifyOtpBtn', 'ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ≠ÿ≥ÿßÿ®');
      }
    }

    // Resend OTP
    async function resendOTP() {
      const email = localStorage.getItem('userEmail');
      if (!email) return;
      
      const button = document.getElementById('resendOtpBtn');
      button.disabled = true;
      button.textContent = 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ...';
      
      try {
        const response = await fetch(`${API_BASE_URL}/users/resend-otp`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email })
        });
        
        const result = await response.json();
        
        if (response.ok) {
          showSuccess('otpSuccess', result.message);
          startResendTimer();
        } else {
          showError('otpErrors', result.message);
          button.disabled = false;
          button.textContent = 'ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ';
        }
      } catch (error) {
        console.error('Resend OTP error:', error);
        showError('otpErrors', 'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ. ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
        button.disabled = false;
        button.textContent = 'ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ';
      }
    }

    // Request password reset
    async function requestPasswordReset(email) {
      showLoading('forgotPasswordBtn', 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ...');
      
      try {
        const response = await fetch(`${API_BASE_URL}/users/reset-password/request`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email })
        });
        
        const result = await response.json();
        
        if (response.ok) {
          showSuccess('forgotPasswordSuccess', 'ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ÿßÿ®ÿ∑ ÿßÿ≥ÿ™ÿπÿßÿØÿ© ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ•ŸÑŸâ ÿ®ÿ±ŸäÿØŸÉ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä');
          document.getElementById('forgotPasswordForm').reset();
        } else {
          showError('forgotPasswordErrors', result.message);
        }
      } catch (error) {
        console.error('Password reset request error:', error);
        showError('forgotPasswordErrors', 'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ. ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
      } finally {
        hideLoading('forgotPasswordBtn', 'ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿßÿ≥ÿ™ÿπÿßÿØÿ©');
      }
    }

    // Reset password
    async function resetPassword(newPassword) {
      const token = localStorage.getItem('resetToken');
      if (!token) {
        showError('resetPasswordErrors', 'ÿ±ŸÖÿ≤ ÿßŸÑÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠');
        return;
      }
      
      showLoading('resetPasswordBtn', 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ≠ŸÅÿ∏...');
      
      try {
        const response = await fetch(`${API_BASE_URL}/users/reset-password/perform`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ token, newPassword })
        });
        
        const result = await response.json();
        
        if (response.ok) {
          showSuccess('resetPasswordSuccess', 'ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ®ŸÜÿ¨ÿßÿ≠');
          localStorage.removeItem('resetToken');
          
          setTimeout(() => {
            closeModal('resetPasswordModal');
            openModal('loginModal');
            showNotification('ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©', 'success');
          }, 2000);
        } else {
          showError('resetPasswordErrors', result.message);
        }
      } catch (error) {
        console.error('Password reset error:', error);
        showError('resetPasswordErrors', 'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ. ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
      } finally {
        hideLoading('resetPasswordBtn', 'ÿ≠ŸÅÿ∏ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©');
      }
    }

    // Logout user
    function logoutUser() {
      clearUserSession();
      updateNavbar();
      showNotification('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠', 'info');
    }

    // Update mode display based on user role (automatic)
    function updateGlobalModeDisplay() {
      if (typeof AUTH !== 'undefined' && AUTH.updateAutoModeDisplay) {
        AUTH.updateAutoModeDisplay();
      }
      // Also update using teacher mode system if available
      if (typeof TeacherMode !== 'undefined' && TeacherMode.updateModeDisplay) {
        TeacherMode.updateModeDisplay();
      }
    }

    // Show notification
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `fixed top-20 right-4 px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300 ${
        type === 'success' ? 'bg-green-600 text-white' : 
        type === 'error' ? 'bg-red-600 text-white' : 
        'bg-blue-600 text-white'
      }`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }

    // üåô Light / Dark Mode
    function toggleTheme() {
      document.body.classList.toggle("light-mode");
    }

    // ============= UI Helper Functions =============
    
    // Open OTP modal
    function openOtpModal(email) {
      document.getElementById('otpEmailDisplay').textContent = email;
      openModal('otpModal');
      startResendTimer();
      setupOtpInputs();
    }
    
    // Open forgot password modal
    function openForgotPasswordModal() {
      closeModal('loginModal');
      openModal('forgotPasswordModal');
    }
    
    // Setup OTP inputs behavior
    function setupOtpInputs() {
      const inputs = document.querySelectorAll('.otp-input');
      inputs.forEach((input, index) => {
        input.addEventListener('input', (e) => {
          if (e.target.value.length === 1 && index < inputs.length - 1) {
            inputs[index + 1].focus();
          }
        });
        
        input.addEventListener('keydown', (e) => {
          if (e.key === 'Backspace' && e.target.value === '' && index > 0) {
            inputs[index - 1].focus();
          }
        });
      });
    }
    
    // Get OTP value from inputs
    function getOtpValue() {
      const inputs = document.querySelectorAll('.otp-input');
      return Array.from(inputs).map(input => input.value).join('');
    }
    
    // Clear OTP inputs
    function clearOtpInputs() {
      document.querySelectorAll('.otp-input').forEach(input => input.value = '');
    }
    
    // Start resend timer
    function startResendTimer() {
      resendTimer = 60;
      const button = document.getElementById('resendOtpBtn');
      const timerSpan = document.getElementById('resendTimer');
      
      button.disabled = true;
      
      resendInterval = setInterval(() => {
        timerSpan.textContent = `(${resendTimer})`;
        resendTimer--;
        
        if (resendTimer < 0) {
          clearInterval(resendInterval);
          button.disabled = false;
          button.textContent = 'ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ';
          timerSpan.textContent = '';
        }
      }, 1000);
    }
    
    // Check authentication state on page load
    function checkAuthState() {
      if (isLoggedIn()) {
        updateNavbar();
      }
    }
    
    // Update navbar based on auth state
    function updateNavbar() {
      const user = getCurrentUser();
      const authButtons = document.querySelector('.hidden.md\\:flex');
      
      if (user && authButtons) {
        const roleText = user.role === 'instructor' ? 'ŸÖÿØÿ±ÿ≥' : user.role === 'admin' ? 'ŸÖÿ¥ÿ±ŸÅ' : 'ÿ∑ÿßŸÑÿ®';
        const roleColor = user.role === 'instructor' ? 'bg-green-600' : user.role === 'admin' ? 'bg-purple-600' : 'bg-blue-600';
        // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ window.AUTH ÿ®ÿ£ŸÖÿßŸÜ ŸÑÿ™ÿ¨ŸÜÿ® ReferenceError ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖÿ≠ŸÖŸÑÿßŸã ÿ®ÿπÿØ
        const authObj = window.AUTH || {};
        const displayName = typeof authObj.getUserDisplayName === 'function'
          ? authObj.getUserDisplayName()
          : (user.firstName || user.name || 'ŸÖÿ≥ÿ™ÿÆÿØŸÖ');
        
        authButtons.innerHTML = `
          <a href="#courses" class="hover:text-blue-300">üìö ÿßŸÑŸÉŸàÿ±ÿ≥ÿßÿ™</a>
          <a href="#teacher" class="hover:text-blue-300">üë®‚Äçüè´ ÿßŸÑŸÖÿØÿ±ÿ≥</a>
          <button onclick="toggleTheme()" class="px-3 py-1 bg-white/20 rounded-lg">üåì</button>
          <div class="flex items-center gap-2 px-3 py-2 bg-blue-600/20 rounded-lg">
            <span class="text-sm">ŸÖÿ±ÿ≠ÿ®ÿßŸãÿå ${displayName}</span>
            <span class="text-xs ${roleColor} px-2 py-1 rounded">${roleText}</span>
          </div>
          <button onclick="logoutUser()" class="px-3 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm">ÿÆÿ±Ÿàÿ¨</button>
        `;
        
        // Update mobile menu too
        const mobileMenu = document.getElementById('mobileMenu');
        mobileMenu.innerHTML = `
          <a href="#courses" class="hover:text-blue-300">üìö ÿßŸÑŸÉŸàÿ±ÿ≥ÿßÿ™</a>
          <a href="#teacher" class="hover:text-blue-300">üë®‚Äçüè´ ÿßŸÑŸÖÿØÿ±ÿ≥</a>
          <button onclick="toggleTheme()" class="px-4 py-2 bg-white/20 rounded-lg">üåì ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸàÿ∂ÿπ</button>
          <div class="px-4 py-2 bg-blue-600/20 rounded-lg">
            <div class="text-sm">ŸÖÿ±ÿ≠ÿ®ÿßŸãÿå ${displayName}</div>
            <div class="text-xs text-blue-300">${user.email}</div>
            <div class="text-xs text-gray-400">${roleText}</div>
          </div>
          <button onclick="logoutUser()" class="px-4 py-2 bg-red-600 rounded-lg">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨</button>
        `;
        
        // Update course visibility based on user role and grade
        updateCourseVisibility();
      } else if (!user && authButtons) {
        // ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ∫Ÿäÿ± ŸÖÿ≥ÿ¨ŸÑ ÿßŸÑÿØÿÆŸàŸÑ ‚Äì ŸÜÿ∂ŸÖŸÜ ÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ£ÿµŸÑŸäÿ© (ŸÇÿØ ÿ™ŸÉŸàŸÜ ÿßÿÆÿ™ŸÅÿ™ ÿ®ÿπÿØ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆÿ±Ÿàÿ¨ ÿ≥ÿßÿ®ŸÇ)
        authButtons.innerHTML = `
          <a href="#courses" class="hover:text-blue-300">üìö ÿßŸÑŸÉŸàÿ±ÿ≥ÿßÿ™</a>
          <a href="#teacher" class="hover:text-blue-300">üë®‚Äçüè´ ÿßŸÑŸÖÿØÿ±ÿ≥</a>
          <button onclick="toggleTheme()" class="px-3 py-1 bg-white/20 rounded-lg">üåì</button>
          <button id="openLogin" class="px-3 sm:px-4 py-2 bg-blue-600 rounded-lg text-sm sm:text-base">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ</button>
          <button id="openRegister" class="px-3 sm:px-4 py-2 bg-green-600 rounded-lg text-sm sm:text-base">ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®</button>
        `;
        // ÿ•ÿπÿßÿØÿ© ÿ®ŸÜÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸàÿ®ÿßŸäŸÑ ŸÉÿ∞ŸÑŸÉ
        const mobileMenu = document.getElementById('mobileMenu');
        if (mobileMenu) {
          mobileMenu.innerHTML = `
            <a href="#courses" class="hover:text-blue-300">üìö ÿßŸÑŸÉŸàÿ±ÿ≥ÿßÿ™</a>
            <a href="#teacher" class="hover:text-blue-300">üë®‚Äçüè´ ÿßŸÑŸÖÿØÿ±ÿ≥</a>
            <button onclick="toggleTheme()" class="px-4 py-2 bg-white/20 rounded-lg">üåì ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸàÿ∂ÿπ</button>
            <button id="openLoginMobile" class="px-4 py-2 bg-blue-600 rounded-lg">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ</button>
            <button id="openRegisterMobile" class="px-4 py-2 bg-green-600 rounded-lg">ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®</button>
          `;
        }
        // ÿ•ÿπÿßÿØÿ© ÿ±ÿ®ÿ∑ ÿßŸÑŸÖÿ≥ÿ™ŸÖÿπÿßÿ™ ÿ®ÿπÿØ ÿ•ÿπÿßÿØÿ© ÿ®ŸÜÿßÿ° ÿßŸÑŸÄ innerHTML
        attachAuthButtonHandlers();
      }
    }

    // Helper: (ÿ•ÿπÿßÿØÿ©) ÿ±ÿ®ÿ∑ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸÖÿµÿßÿØŸÇÿ© ŸÖÿπ ÿßŸÑŸÖŸàÿØÿßŸÑÿßÿ™ ‚Äì ÿ™ÿ™ÿ≠ŸÖŸÑ ÿßŸÑÿ™ŸÉÿ±ÿßÿ± ÿ®ÿ£ŸÖÿßŸÜ
    function attachAuthButtonHandlers() {
      const loginBtn = document.getElementById('openLogin');
      const registerBtn = document.getElementById('openRegister');
      const loginBtnMob = document.getElementById('openLoginMobile');
      const registerBtnMob = document.getElementById('openRegisterMobile');

      if (loginBtn) loginBtn.onclick = () => openModal('loginModal');
      if (registerBtn) registerBtn.onclick = () => openModal('registerModal');
      if (loginBtnMob) loginBtnMob.onclick = () => openModal('loginModal');
      if (registerBtnMob) registerBtnMob.onclick = () => openModal('registerModal');

      // ŸÉŸàÿØ ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä ÿπÿ®ÿ± ÿßŸÑÿ™ŸÅŸàŸäÿ∂ ‚Äì Ÿäÿ∂ŸÖŸÜ ÿßŸÑÿπŸÖŸÑ ÿ≠ÿ™Ÿâ ŸÑŸà ÿ™ÿ®ÿØŸÑÿ™ ÿßŸÑÿπŸÜÿßÿµÿ± ŸÑÿßÿ≠ŸÇÿßŸã
      if (!window.__authDelegationBound) {
        document.addEventListener('click', (e) => {
          if (e.target && (e.target.id === 'openLogin' || e.target.id === 'openLoginMobile')) {
            openModal('loginModal');
          } else if (e.target && (e.target.id === 'openRegister' || e.target.id === 'openRegisterMobile')) {
            openModal('registerModal');
          }
        });
        window.__authDelegationBound = true;
      }
    }
    
    // Add real-time validation
    function addRealTimeValidation() {
      // Email validation
      const emailInputs = document.querySelectorAll('input[type="email"]');
      emailInputs.forEach(input => {
        input.addEventListener('blur', function() {
          if (this.value && !validateEmail(this.value)) {
            this.style.borderColor = '#ef4444';
            showTooltip(this, 'ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠');
          } else {
            this.style.borderColor = 'rgba(255, 255, 255, 0.2)';
            hideTooltip(this);
          }
        });
      });
      
      // Password validation
      const passwordInputs = document.querySelectorAll('input[type="password"]');
      passwordInputs.forEach(input => {
        input.addEventListener('input', function() {
          if (this.value && !validatePassword(this.value)) {
            this.style.borderColor = '#ef4444';
          } else if (this.value) {
            this.style.borderColor = '#10b981';
          }
        });
      });
      
      // Full name validation
      const fullNameInput = document.getElementById('fullName');
      const fullNameIndicator = document.getElementById('fullNameIndicator');
      const nameCount = document.getElementById('nameCount');
      
      if (fullNameInput) {
        fullNameInput.addEventListener('input', function() {
          const value = this.value;
          
          // Update character count
          if (nameCount) {
            nameCount.textContent = `${value.length}/100 ÿ≠ÿ±ŸÅ`;
            if (fullNameIndicator) {
              fullNameIndicator.classList.remove('hidden');
            }
          }
          
          if (value.length > 0) {
            if (value.length < 10) {
              this.style.borderColor = '#ef4444';
              if (nameCount) nameCount.className = 'text-red-400';
              showTooltip(this, `ÿßŸÑÿßÿ≥ŸÖ ŸÇÿµŸäÿ± ÿ¨ÿØÿßŸã (${value.length}/10 ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ)`);
            } else if (value.length > 100) {
              this.style.borderColor = '#ef4444';
              if (nameCount) nameCount.className = 'text-red-400';
              showTooltip(this, `ÿßŸÑÿßÿ≥ŸÖ ÿ∑ŸàŸäŸÑ ÿ¨ÿØÿßŸã (${value.length}/100 ÿ≠ÿ±ŸÅ ŸÉÿ≠ÿØ ÿ£ŸÇÿµŸâ)`);
            } else if (!validateFullName(value)) {
              this.style.borderColor = '#ef4444';
              if (nameCount) nameCount.className = 'text-yellow-400';
              showTooltip(this, 'Ÿäÿ¨ÿ® ÿ•ÿØÿÆÿßŸÑ 3 ÿ£ÿ≥ŸÖÿßÿ° ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ ŸÖŸÅÿµŸàŸÑÿ© ÿ®ŸÖÿ≥ÿßŸÅÿßÿ™');
            } else {
              this.style.borderColor = '#10b981';
              if (nameCount) nameCount.className = 'text-green-400';
              hideTooltip(this);
            }
          } else {
            if (fullNameIndicator) {
              fullNameIndicator.classList.add('hidden');
            }
          }
        });
        
        fullNameInput.addEventListener('blur', function() {
          if (this.value && !validateFullName(this.value)) {
            this.style.borderColor = '#ef4444';
          }
        });
      }
    }
    
    function showTooltip(element, message) {
      hideTooltip(element); // Remove existing tooltip
      const tooltip = document.createElement('div');
      tooltip.className = 'validation-tooltip';
      tooltip.textContent = message;
      tooltip.style.cssText = `
        position: absolute;
        bottom: -30px;
        right: 0;
        background: #ef4444;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        white-space: nowrap;
        z-index: 1000;
      `;
      element.style.position = 'relative';
      element.parentElement.appendChild(tooltip);
    }
    
    function hideTooltip(element) {
      const tooltip = element.parentElement.querySelector('.validation-tooltip');
      if (tooltip) {
        tooltip.remove();
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      // Add real-time validation
      addRealTimeValidation();
      
      // Registration form
      const signupForm = document.getElementById('signupForm');
      if (signupForm) {
        console.log('Adding event listener to signup form');
        signupForm.addEventListener('submit', async (e) => {
          console.log('Signup form submitted');
          e.preventDefault();
          const formData = new FormData(e.target);
          await registerUser(formData);
        });
      } else {
        console.error('Signup form not found!');
      }
      
      // Login form
      document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        
        await loginUser(email, password);
      });
      
      // OTP form
      document.getElementById('otpForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = localStorage.getItem('userEmail');
        const otp = getOtpValue();
        
        if (otp.length !== 6) {
          showError('otpErrors', 'Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿ±ŸÖÿ≤ ŸÉÿßŸÖŸÑÿßŸã (6 ÿ£ÿ±ŸÇÿßŸÖ)');
          return;
        }
        
        await verifyOTP(email, otp);
      });
      
      // Forgot password form
      document.getElementById('forgotPasswordForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('forgotEmail').value;
        await requestPasswordReset(email);
      });
      
      // Reset password form
      document.getElementById('resetPasswordForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmNewPassword').value;
        
        if (newPassword !== confirmPassword) {
          showError('resetPasswordErrors', 'ŸÉŸÑŸÖÿ™ÿß ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ŸÖÿ™ÿ∑ÿßÿ®ŸÇÿ™ÿßŸÜ');
          return;
        }
        
        if (newPassword.length < 8) {
          showError('resetPasswordErrors', 'ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ 8 ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ');
          return;
        }
        
        await resetPassword(newPassword);
      });
      
  // Modal buttons (ÿ≠ŸÖÿßŸäÿ© ŸÖŸÜ ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ÿßŸÑÿπŸÜÿßÿµÿ± ŸÑŸà ÿ™ŸÖ ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑŸáÿß ÿ®ÿπÿØ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ)
  const btnLogin = document.getElementById('openLogin');
  const btnRegister = document.getElementById('openRegister');
  const btnLoginMob = document.getElementById('openLoginMobile');
  const btnRegisterMob = document.getElementById('openRegisterMobile');

  if (btnLogin) btnLogin.onclick = () => openModal('loginModal');
  if (btnRegister) btnRegister.onclick = () => openModal('registerModal');
  if (btnLoginMob) btnLoginMob.onclick = () => openModal('loginModal');
  if (btnRegisterMob) btnRegisterMob.onclick = () => openModal('registerModal');
      
      // Course card handlers
      addCourseCardHandlers();
      
      // Close modals when clicking outside
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal')) {
          const modalId = e.target.id;
          closeModal(modalId);
        }
      });
    }

    // Open/close modals
    function openModal(id) {
      const modal = document.getElementById(id);
      modal.style.display = 'flex';
      setTimeout(() => modal.classList.add('show'), 10);
    }
    
    function closeModal(id) {
      const modal = document.getElementById(id);
      modal.classList.remove('show');
      setTimeout(() => modal.style.display = 'none', 300);
    }

    // ============= Page Protection & Navigation =============
    
    // Check if user has access to specific grade
    function hasGradeAccess(gradeKey) {
      const user = getCurrentUser();
      if (!user) return false;
      
      // Instructors and admins can access all grades
      if (user.role === 'instructor' || user.role === 'admin') {
        return true;
      }

      // Normalize Arabic or stored grade values to internal codes
      function normalizeGrade(g) {
        if (!g || typeof g !== 'string') return g;
        const s = g.trim().toLowerCase();
        const map = {
          // Internal codes pass-through
          'grade1': 'grade1',
          'grade2': 'grade2',
          'grade2sci': 'grade2sci',
          'grade2art': 'grade2art',
          'grade3': 'grade3',
          'grade3sci': 'grade3sci',
          'grade3art': 'grade3art',
          // Arabic variants
          'ÿßŸÑÿµŸÅ ÿßŸÑÿ£ŸàŸÑ ÿßŸÑÿ´ÿßŸÜŸàŸä': 'grade1',
          'ÿßŸÑÿµŸÅ ÿßŸÑÿßŸàŸÑ ÿßŸÑÿ´ÿßŸÜŸàŸä': 'grade1',
          'ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä ÿßŸÑÿ´ÿßŸÜŸàŸä': 'grade2',
          'ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä ÿßŸÑÿ´ÿßŸÜŸàŸä ÿπŸÑŸÖŸä': 'grade2sci',
            'ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä - ÿπŸÑŸÖŸä': 'grade2sci',
          'ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä ÿßŸÑÿ´ÿßŸÜŸàŸä ÿßÿØÿ®Ÿä': 'grade2art',
            'ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä - ÿ£ÿØÿ®Ÿä': 'grade2art',
          'ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿ´ÿßŸÜŸàŸä': 'grade3',
          'ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿ´ÿßŸÜŸàŸä ÿπŸÑŸÖŸä': 'grade3sci',
            'ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ - ÿπŸÑŸÖŸä': 'grade3sci',
          'ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿ´ÿßŸÜŸàŸä ÿßÿØÿ®Ÿä': 'grade3art',
            'ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ - ÿ£ÿØÿ®Ÿä': 'grade3art'
        };
        return map[s] || g; // fallback: return original
      }

      const userNormalized = normalizeGrade(user.grade);

      // Exact match (student picked specific track)
      if (userNormalized === gradeKey) return true;

      // If student has generic grade (without specialization) allow both tracks of that grade
      if (userNormalized === 'grade2' && (gradeKey === 'grade2sci' || gradeKey === 'grade2art')) return true;
      if (userNormalized === 'grade3' && (gradeKey === 'grade3sci' || gradeKey === 'grade3art')) return true;

      // Allow mapping from specialization back to generic if needed
      if ((userNormalized === 'grade2sci' || userNormalized === 'grade2art') && gradeKey === 'grade2') return true;
      if ((userNormalized === 'grade3sci' || userNormalized === 'grade3art') && gradeKey === 'grade3') return true;

      return false; // No access
    }
    
    // Redirect functions for authenticated users
    function redirectToGrade(grade) {
      // Check if user is logged in first
      if (!isLoggedIn()) {
        showNotification('Ÿäÿ¨ÿ® ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ£ŸàŸÑÿßŸã ŸÑŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ÿßŸÑŸÉŸàÿ±ÿ≥ÿßÿ™ ÿßŸÑÿ™ÿπŸÑŸäŸÖŸäÿ©', 'error');
        
        // Open login modal automatically
        setTimeout(() => {
          openModal('loginModal');
        }, 500);
        
        console.log('User not logged in, opening login modal for grade:', grade);
        return;
      }
      
      const user = getCurrentUser();
      const gradeNames = {
        "grade1": "ÿßŸÑÿµŸÅ ÿßŸÑÿ£ŸàŸÑ ÿßŸÑÿ´ÿßŸÜŸàŸä",
        "grade2": "ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä ÿßŸÑÿ´ÿßŸÜŸàŸä (ÿπÿßŸÖ)",
        "grade2sci": "ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä ÿßŸÑÿ´ÿßŸÜŸàŸä - ÿπŸÑŸÖŸä",
        "grade2art": "ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä ÿßŸÑÿ´ÿßŸÜŸàŸä - ÿ£ÿØÿ®Ÿä", 
        "grade3": "ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿ´ÿßŸÜŸàŸä (ÿπÿßŸÖ)",
        "grade3sci": "ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿ´ÿßŸÜŸàŸä - ÿπŸÑŸÖŸä",
        "grade3art": "ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿ´ÿßŸÜŸàŸä - ÿ£ÿØÿ®Ÿä"
      };
      
      // Check if user has access to this grade
      if (!hasGradeAccess(grade)) {
        const gradeName = gradeNames[grade] || grade;
        if (user.role === 'student') {
          showNotification(`ÿπÿ∞ÿ±ÿßŸãÿå ŸäŸÖŸÉŸÜŸÉ ÿßŸÑŸàÿµŸàŸÑ ŸÅŸÇÿ∑ ŸÑÿµŸÅÿ≠ŸÉ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä`, 'error');
        } else {
          showNotification(`ŸÑŸäÿ≥ ŸÑÿØŸäŸÉ ÿµŸÑÿßÿ≠Ÿäÿ© ŸÑŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ${gradeName}`, 'error');
        }
        return;
      }
      
      // Map grade keys to actual page files
      const pages = {
        "grade1": "grade1.html",
        "grade2sci": "grade2_1.html", 
        "grade2art": "grade2_2.html",
        "grade3sci": "grade3_1.html",
        "grade3art": "grade3_2.html"
      };
      
      if (pages[grade]) {
        console.log(`Redirecting ${user.role} to ${pages[grade]} for grade: ${grade}`);
        window.location.href = pages[grade];
      } else {
        showNotification('ÿßŸÑÿµŸÅÿ≠ÿ© ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØÿ©', 'error');
      }
    }
    
    // Update course card visibility based on user access
    function updateCourseVisibility() {
      const courseCards = document.querySelectorAll('.course-card');
      const grades = [
        'grade1',      // ÿßŸÑÿµŸÅ ÿßŸÑÿ£ŸàŸÑ ÿßŸÑÿ´ÿßŸÜŸàŸä
        'grade2sci',   // ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä - ÿπŸÑŸÖŸä  
        'grade2art',   // ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä - ÿ£ÿØÿ®Ÿä
        'grade3sci',   // ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿ´ÿßŸÜŸàŸä (ÿπŸÑŸÖŸä)
        'grade3art'    // ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿ´ÿßŸÜŸàŸä (ÿ£ÿØÿ®Ÿä)
      ];
      
      courseCards.forEach((card, index) => {
        const grade = grades[index];
        if (grade) {
          const hasAccess = hasGradeAccess(grade);
          
          // Remove any existing badges first
          const existingBadge = card.querySelector('.no-access-badge');
          if (existingBadge) {
            existingBadge.remove();
          }
          
          const user = getCurrentUser();
          
          if (hasAccess) {
            card.classList.remove('opacity-50', 'cursor-not-allowed');
            card.classList.add('cursor-pointer');
          } else {
            card.classList.add('opacity-50', 'cursor-not-allowed');
            card.classList.remove('cursor-pointer');
            
            // Add appropriate badge based on user status
            const badge = document.createElement('div');
            badge.className = 'no-access-badge absolute top-2 right-2 text-white text-xs px-2 py-1 rounded';
            card.style.position = 'relative';
            
            if (!user) {
              // User not logged in
              badge.className += ' bg-orange-500';
              badge.textContent = 'ÔøΩ Ÿäÿ™ÿ∑ŸÑÿ® ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ';
            } else if (user.role === 'student') {
              // Student without access
              badge.className += ' bg-red-500';
              badge.textContent = 'üîí ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠';
            }
            
            card.appendChild(badge);
          }
        }
      });
    }

    // Add course card click handlers
    function addCourseCardHandlers() {
      const courseCards = document.querySelectorAll('.course-card');
      courseCards.forEach((card, index) => {
        card.addEventListener('click', function() {
          // Map each course card to its corresponding grade
          const grades = [
            'grade1',      // ÿßŸÑÿµŸÅ ÿßŸÑÿ£ŸàŸÑ ÿßŸÑÿ´ÿßŸÜŸàŸä
            'grade2sci',   // ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä - ÿπŸÑŸÖŸä  
            'grade2art',   // ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÜŸä - ÿ£ÿØÿ®Ÿä
            'grade3sci',   // ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿ´ÿßŸÜŸàŸä (ÿπŸÑŸÖŸä)
            'grade3art'    // ÿßŸÑÿµŸÅ ÿßŸÑÿ´ÿßŸÑÿ´ ÿßŸÑÿ´ÿßŸÜŸàŸä (ÿ£ÿØÿ®Ÿä)
          ];
          
          if (grades[index]) {
            redirectToGrade(grades[index]);
          }
        });
      });
    }
    
    // Create protected API request function
    async function protectedRequest(url, options = {}) {
      const token = getAuthToken();
      if (!token) {
        logoutUser();
        throw new Error('ŸÑÿß ŸäŸàÿ¨ÿØ ÿ±ŸÖÿ≤ ŸÖÿµÿßÿØŸÇÿ©');
      }
      
      const headers = {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`,
        ...options.headers
      };
      
      try {
        const response = await fetch(url, {
          ...options,
          headers
        });
        
        if (response.status === 401) {
          logoutUser();
          throw new Error('ÿßŸÜÿ™Ÿáÿ™ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©. Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ');
        }
        
        if (response.status === 403) {
          const result = await response.json();
          if (result.requiresVerification) {
            openOtpModal(getCurrentUser().email);
            throw new Error('Ÿäÿ¨ÿ® ÿ™ŸÅÿπŸäŸÑ ÿ≠ÿ≥ÿßÿ®ŸÉ ÿ£ŸàŸÑÿßŸã');
          }
        }
        
        return response;
      } catch (error) {
        if (error.message.includes('NetworkError') || error.message.includes('fetch')) {
          throw new Error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿ™ÿµÿßŸÑŸÉ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™');
        }
        throw error;
      }
    }

    // Mobile menu
    const menuToggle = document.getElementById("menuToggle");
    const mobileMenu = document.getElementById("mobileMenu");
    menuToggle.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
    });
  </script>
  
  <!-- Teacher Mode Auto System -->
  <script src="../js/teacher-mode.js"></script>
</body>
</html>