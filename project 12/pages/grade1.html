<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ - Ù…Ù†ØµÙ‡ Ø§Ù„Ø¨Ø¯Ø§ÙŠÙ‡</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Auth utilities (ÙŠØ¬Ø¨ ØªØ­Ù…ÙŠÙ„Ù‡ Ù‚Ø¨Ù„ Ø£ÙŠ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ù„Ù€ getCurrentUser) -->
  <script src="../js/auth.js"></script>
  <!-- Dynamic Lessons API utilities -->
  <script src="../js/lessons.js"></script>
  <style>
    body {
      background: linear-gradient(to bottom right, #bfdbfe, #ddd6fe, #fbcfe8);
      transition: background 0.5s ease;
    }
    html.dark body {
      background: linear-gradient(to bottom right, #0f172a, #1e293b, #334155);
    }
    .subject-card, .homework-card, .pdf-card, .schedule-item, .quiz-card {
      transition: all 0.3s ease;
    }
    .subject-card:hover, .homework-card:hover, .pdf-card:hover, .schedule-item:hover, .quiz-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    .nav-tab.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
    }
    .schedule-time {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .teacher-mode-indicator {
      position: absolute;
      top: -8px;
      right: -8px;
      background: linear-gradient(135deg, #8b5cf6, #a855f7);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    .teacher-tools {
      border-top: 2px dashed #8b5cf6;
      background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
      margin-top: 1rem;
      padding-top: 1rem;
    }
    html.dark .teacher-tools {
      background: linear-gradient(135deg, #374151, #4b5563);
    }
    #themeToggle {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(255, 255, 255, 0.8);
      border: none;
      border-radius: 9999px;
      width: 50px;
      height: 50px;
      cursor: pointer;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      transition: background 0.3s ease;
      z-index: 1000;
    }
    #themeToggle:hover {
      background: rgba(255, 255, 255, 1);
    }
    html.dark #themeToggle {
      background: rgba(30, 41, 59, 0.8);
      color: #e2e8f0;
    }
    html.dark #themeToggle:hover {
      background: rgba(30, 41, 59, 1);
    }

    /* Schedule Card Styles */
    .schedule-card {
      border-left: 4px solid #4CAF50;
      padding: 1rem;
    }

    /* Modal Styles */
    .modal {
      background: rgba(0, 0, 0, 0.5);
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }

    .modal h3 {
      margin-bottom: 1.5rem;
      color: #2c3e50;
      text-align: center;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: #555;
      font-weight: bold;
    }

    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      direction: rtl;
      text-align: right;
    }

    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
    }

    .form-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 2rem;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s;
    }

    .btn-primary {
      background: #3498db;
      color: white;
    }

    .btn-primary:hover {
      background: #2980b9;
    }

    .btn-secondary {
      background: #95a5a6;
      color: white;
    }

    .btn-secondary:hover {
      background: #7f8c8d;
    }

    .hidden {
      display: none !important;
    }

    /* Notification Styles */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      color: white;
      z-index: 1001;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s ease;
    }

    .notification.show {
      opacity: 1;
      transform: translateX(0);
    }

    .notification.success {
      background: #27ae60;
    }

    .notification.error {
      background: #e74c3c;
    }

    .notification.warning {
      background: #f39c12;
    }
  </style>
</head>
<body class="min-h-screen">

  <!-- Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ -->
  <button id="themeToggle" aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹">ğŸŒ™</button>

  <!-- Ø¨Ø§Ù†Ø± ØªØ±Ø­ÙŠØ¨ -->
  <section id="welcomeBox" class="container mx-auto mt-6 hidden px-4">
    <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-lg shadow-lg flex flex-col md:flex-row justify-between items-center gap-3">
      <span id="welcomeText" class="font-semibold text-lg text-center md:text-right"></span>
      <button id="logoutBtn" class="bg-white text-blue-600 px-4 py-2 rounded-lg shadow hover:bg-gray-100 w-full md:w-auto">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>
  </section>

  <!-- Header -->
  <header class="bg-white shadow-lg mt-4 md:mt-0">
    <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
      <!-- Ø§Ù„ØµÙ -->
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
          <i class="fas fa-graduation-cap text-white text-xl"></i>
        </div>
        <div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-800">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</h1>
          <p class="text-gray-600">Ù…Ù†ØµÙ‡ Ø§Ù„Ø¨Ø¯Ø§ÙŠÙ‡</p>
        </div>
      </div>

      <!-- ÙŠÙ…ÙŠÙ†: Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ + Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³ØªØ§Ø° + ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯Ø±Ø³ -->
      <div class="flex items-center gap-4 md:gap-6 flex-col md:flex-row">
        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ -->
        <div class="relative inline-block text-left">
          <button id="userMenuBtn" class="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-full shadow hover:bg-blue-700 w-full md:w-auto">
            <span id="studentName">ğŸ‘¤ Ø§Ù„Ø·Ø§Ù„Ø¨</span>
            <i class="fas fa-caret-down"></i>
          </button>
          <div id="userMenu" class="hidden absolute right-0 mt-2 w-48 bg-white border rounded-lg shadow-lg z-50">
            <a href="profile.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
            <a href="grades.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</a>
            <a href="calendar.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</a>
            <a href="settings.html" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
            <hr>
            <button id="logoutBtn2" class="w-full text-right px-4 py-2 text-red-600 hover:bg-red-100">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
          </div>
        </div>

        <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³ØªØ§Ø° + Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ -->
        <div class="flex items-center gap-3">
          <!-- Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø­ØµØ© Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙÙ‚Ø· -->
          <div id="addLessonHeaderBtn" class="hidden">
            <a href="add-lesson.html" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
              <i class="fas fa-plus"></i>
              <span>Ø¥Ø¶Ø§ÙØ© Ø­ØµØ©</span>
            </a>
          </div>
          
          <!-- Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø§Ø³ÙŠ Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙÙ‚Ø· -->
          <div id="addScheduleHeaderBtn" class="hidden">
            <a href="add-schedule-simple.html" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
              <i class="fas fa-calendar-plus"></i>
              <span>Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙˆÙ„</span>
            </a>
          </div>
          
          <!-- Ø²Ø± Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ø¬Ø¨ Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙÙ‚Ø· -->
          <div id="addHomeworkHeaderBtn" class="hidden">
            <a href="add-homework.html" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
              <i class="fas fa-tasks"></i>
              <span>Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ø¬Ø¨</span>
            </a>
          </div>
          
          <div class="relative">
            <img src="../images/photo_2025-09-03_00-20-27.jpg" class="w-12 h-12 rounded-full border-2 border-blue-400" alt="Ø£/ Ù…Ø¬Ø¯ÙŠ Ø¬Ù…Ø§Ù„" />
            <div id="teacherModeIndicator" class="teacher-mode-indicator hidden">Ù…Ø¯Ø±Ø³</div>
          </div>
          <div class="text-right">
            <p class="font-semibold text-gray-800">Ø£/ Ù…Ø¬Ø¯ÙŠ Ø¬Ù…Ø§Ù„</p>
            <p class="text-sm text-gray-600">Ù…Ø¯Ø±Ø³ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</p>
          </div>
          <div id="teacherModeIndicator" class="teacher-mode-indicator hidden">Ù…Ø¯Ø±Ø³</div>
        </div>
      </div>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="bg-white shadow-md mt-4 overflow-x-auto">
    <div class="container mx-auto px-4 py-3 flex justify-center gap-2 min-w-max">
      <button class="nav-tab active px-4 py-2 rounded-lg font-semibold whitespace-nowrap" data-tab="sessions">
        ğŸ“ Ø§Ù„Ø­ØµØµ
      </button>
      <button class="nav-tab px-4 py-2 rounded-lg font-semibold whitespace-nowrap" data-tab="schedule">
        ğŸ“… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ
      </button>
      <button class="nav-tab px-4 py-2 rounded-lg font-semibold whitespace-nowrap" data-tab="homework">
        ğŸ“ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª
      </button>
      <button class="nav-tab px-4 py-2 rounded-lg font-semibold whitespace-nowrap" data-tab="materials">
        ğŸ“š Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©
      </button>
      <button class="nav-tab px-4 py-2 rounded-lg font-semibold whitespace-nowrap" data-tab="quizzes">
        ğŸ¯ Ø§Ù„ÙƒÙˆÙŠØ²Ø§Øª
      </button>
    </div>
  </nav>

  <!-- Main -->
  <main class="container mx-auto px-4 py-8">
    <!-- Sessions -->
    <div id="sessions-tab" class="tab-content">
      <h2 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-8">ğŸ“ Ø§Ù„Ø­ØµØµ</h2>
      <div id="lessonsToolbar" class="mb-6"></div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="lessonsGrid">
        <!-- Lesson cards will be generated by JavaScript -->
      </div>
    </div>

    <!-- Schedule -->
    <div id="schedule-tab" class="tab-content hidden">
      <h2 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-8">ğŸ“… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</h2>
      
      <!-- Teacher Tools for Schedule -->
      <div id="scheduleTeacherTools" class="teacher-tools rounded-lg p-4 mb-6 hidden">
        <h3 class="text-lg font-bold text-purple-800 mb-4">ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø¯Ø±Ø³ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„</h3>
        <div class="flex flex-col md:flex-row gap-4">
          <input type="text" id="scheduleDay" placeholder="Ø§Ù„ÙŠÙˆÙ… (Ù…Ø«Ø§Ù„: Ø§Ù„Ø£Ø­Ø¯)" class="flex-1 px-3 py-2 border border-gray-300 rounded-md" />
          <input type="text" id="scheduleSubject" placeholder="Ø§Ù„Ù…Ø§Ø¯Ø©" class="flex-1 px-3 py-2 border border-gray-300 rounded-md" />
          <input type="time" id="scheduleTimeStart" class="px-3 py-2 border border-gray-300 rounded-md" />
          <input type="time" id="scheduleTimeEnd" class="px-3 py-2 border border-gray-300 rounded-md" />
          <button onclick="addScheduleItem()" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">â• Ø¥Ø¶Ø§ÙØ©</button>
        </div>
      </div>

      <div id="scheduleGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Schedule items will be generated by JavaScript -->
      </div>
    </div>

    <!-- Homework -->
    <div id="homework-tab" class="tab-content hidden">
      <h2 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-8">ğŸ“ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</h2>
      
      <!-- Teacher Tools for Homework -->
      <div id="homeworkTeacherTools" class="teacher-tools rounded-lg p-4 mb-6 hidden">
        <h3 class="text-lg font-bold text-purple-800 mb-4">ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø¯Ø±Ø³ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</h3>
        <div class="flex flex-col md:flex-row gap-4 justify-center">
          <a href="add-homework.html" class="px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg flex items-center gap-2 transition-colors font-semibold">
            <i class="fas fa-tasks"></i>
            Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ø¬Ø¨ Ø¬Ø¯ÙŠØ¯
          </a>
        </div>
      </div>

      <div id="homeworkGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Homework items will be generated by JavaScript -->
      </div>
    </div>

    <!-- Materials -->
    <div id="materials-tab" class="tab-content hidden">
      <h2 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-8">ğŸ“š Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h2>
      
      <!-- Teacher Tools for Materials -->
      <div id="materialsTeacherTools" class="teacher-tools rounded-lg p-4 mb-6 hidden">
        <h3 class="text-lg font-bold text-purple-800 mb-4">ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø¯Ø±Ø³ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¯</h3>
        <div class="flex flex-col md:flex-row gap-4">
          <input type="text" id="materialTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø§Ø¯Ø©" class="flex-1 px-3 py-2 border border-gray-300 rounded-md" />
          <input type="text" id="materialDescription" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø§Ø¯Ø©" class="flex-1 px-3 py-2 border border-gray-300 rounded-md" />
          <input type="url" id="materialLink" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù Ø£Ùˆ PDF" class="flex-1 px-3 py-2 border border-gray-300 rounded-md" />
          <button onclick="addMaterial()" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">â• Ø¥Ø¶Ø§ÙØ©</button>
        </div>
      </div>

      <div id="materialsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Material items will be generated by JavaScript -->
      </div>
    </div>

    <!-- Quizzes -->
    <div id="quizzes-tab" class="tab-content hidden">
      <h2 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-8">ğŸ¯ Ø§Ù„ÙƒÙˆÙŠØ²Ø§Øª</h2>
      
      <!-- Teacher Tools for Quizzes -->
      <div id="quizzesTeacherTools" class="teacher-tools rounded-lg p-4 mb-6 hidden">
        <h3 class="text-lg font-bold text-purple-800 mb-4">ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø¯Ø±Ø³ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙˆÙŠØ²Ø§Øª</h3>
        <div class="flex flex-col md:flex-row gap-4">
          <input type="text" id="quizTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒÙˆÙŠØ²" class="flex-1 px-3 py-2 border border-gray-300 rounded-md" />
          <textarea id="quizDescription" placeholder="ÙˆØµÙ Ø§Ù„ÙƒÙˆÙŠØ²" class="flex-1 px-3 py-2 border border-gray-300 rounded-md" rows="2"></textarea>
          <select id="quizStatus" class="px-3 py-2 border border-gray-300 rounded-md">
            <option value="available">Ù…ØªØ§Ø­</option>
            <option value="coming-soon">Ù‚Ø±ÙŠØ¨Ø§Ù‹</option>
            <option value="closed">Ù…ØºÙ„Ù‚</option>
          </select>
          <button onclick="addQuiz()" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">â• Ø¥Ø¶Ø§ÙØ©</button>
        </div>
      </div>

      <div id="quizzesGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Quiz items will be generated by JavaScript -->
      </div>
    </div>
  </main>

  <!-- JS -->
  <script>
    /* âœ… Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©: Ø§Ù„Ø³Ù…Ø§Ø­ ÙÙ‚Ø· Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³Ø¬Ù„ Ùˆ Ø§Ù„Ø°ÙŠ ÙŠÙ…ØªÙ„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ */
    (function guardAccess(){
      try {
        const authObj = window.AUTH || {};
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠØ­Ù…Ù„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø¨Ø¹Ø¯ â€“ Ù†Ù†ØªØ¸Ø± ÙˆÙ†Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©
        if (!authObj.getCurrentUser) {
          return setTimeout(guardAccess, 50);
        }
        const user = authObj.getCurrentUser();
        if (!user) {
          // Ø­ÙØ¸ Ù†ÙŠØ© Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
          localStorage.setItem('postLoginRedirect', 'grade1.html');
          window.location.href = 'index_updated.html';
          return;
        }
        // ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ… ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        const wantedGrade = 'grade1';
        const normalize = (g)=>{
          if(!g) return g; const s=g.trim().toLowerCase();
          const map={
            'grade1':'grade1', 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ':'grade1','Ø§Ù„ØµÙ Ø§Ù„Ø§ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ':'grade1'
          }; return map[s]||g;
        };
        const userNorm = normalize(user.grade);
        const isInstructor = user.role === 'instructor' || user.role === 'admin';
        if (!isInstructor && userNorm !== wantedGrade) {
          // Ø·Ø§Ù„Ø¨ ÙŠØ­Ø§ÙˆÙ„ ÙØªØ­ ØµÙ Ù„ÙŠØ³ ØµÙÙ‡
            window.location.href = 'index_updated.html';
        }
      } catch(e){ console.error('Grade1 guard error:', e); }
    })();
    // Global state - will be set based on user role
    let isTeacherMode = false;
    
    // Dynamic lessons state (fetched from API)
    let lessons = [];
    let lessonsLoading = false;
    let lessonsError = null;
    
    // Schedule state
    let schedules = [];
    
    // Homework/Tasks state
    let homework = [];
    let homeworkLoading = false;
    let homeworkError = null;
    
    let currentLessonPage = 1;
    const LESSONS_PAGE_SIZE = 24;
    let currentLessonSearch = '';
    let currentLessonUnit = '';

    // Initialize on page load
    document.addEventListener("DOMContentLoaded", () => {
      // Set teacher mode based on user role automatically
      if (typeof AUTH !== 'undefined' && AUTH.getCurrentTeacherModeState) {
        isTeacherMode = AUTH.getCurrentTeacherModeState();
      } else {
        // Fallback: check if user is instructor
        const user = getCurrentUser();
        isTeacherMode = user && (user.role === 'instructor' || user.role === 'admin');
      }
      
      if (isTeacherMode) {
        updateModeDisplay();
      }

  renderAllContent();
  loadLessons();
  loadSchedules();
  loadHomework();
  setupLessonsToolbar();
  
      // Show add lesson header button for authorized users
      if (window.LessonsAPI && LessonsAPI.canManage()) {
        const addLessonHeaderBtn = document.getElementById('addLessonHeaderBtn');
        if (addLessonHeaderBtn) {
          addLessonHeaderBtn.classList.remove('hidden');
        }
        
        // Show add schedule header button
        const addScheduleHeaderBtn = document.getElementById('addScheduleHeaderBtn');
        if (addScheduleHeaderBtn) {
          addScheduleHeaderBtn.classList.remove('hidden');
        }
        
        // Show add homework header button
        const addHomeworkHeaderBtn = document.getElementById('addHomeworkHeaderBtn');
        if (addHomeworkHeaderBtn) {
          addHomeworkHeaderBtn.classList.remove('hidden');
        }
      }
      
      const studentName = localStorage.getItem("studentName") || "ğŸ‘¤ Ø§Ù„Ø·Ø§Ù„Ø¨";
      document.getElementById("studentName").textContent = studentName;

      if (studentName && studentName !== "ğŸ‘¤ Ø§Ù„Ø·Ø§Ù„Ø¨") {
        document.getElementById("welcomeBox").classList.remove("hidden");
        document.getElementById("welcomeText").textContent = `ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ØŒ ${studentName} â€” Ø³Ø¹ÙŠØ¯ Ø¨ÙˆØ¬ÙˆØ¯Ùƒ ÙÙŠ Ù…Ù†ØµØ© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ğŸ‰`;
      }

      // Tabs functionality
      const tabs = document.querySelectorAll(".nav-tab");
      const tabContents = document.querySelectorAll(".tab-content");
      tabs.forEach((tab) => {
        tab.addEventListener("click", function () {
          tabs.forEach((t) => t.classList.remove("active"));
          this.classList.add("active");
          tabContents.forEach((c) => c.classList.add("hidden"));
          document.getElementById(this.dataset.tab + "-tab").classList.remove("hidden");
        });
      });
    });

    // Update mode display based on user role (automatic)
    function updateModeDisplay() {
      // Use the new teacher mode system if available
      if (typeof TeacherMode !== 'undefined') {
        TeacherMode.updateModeDisplay();
        isTeacherMode = TeacherMode.isTeacherMode;
      } else {
        // Fallback to manual implementation
        const indicator = document.getElementById('teacherModeIndicator');
        
        // Get teacher mode state from user role
        if (typeof AUTH !== 'undefined' && AUTH.getCurrentTeacherModeState) {
          isTeacherMode = AUTH.getCurrentTeacherModeState();
        } else {
          // Fallback: check if user is instructor
          const user = getCurrentUser ? getCurrentUser() : null;
          isTeacherMode = user && (user.role === 'instructor' || user.role === 'admin');
        }
        
        if (indicator) {
          if (isTeacherMode) {
            indicator.classList.remove('hidden');
            showTeacherTools();
          } else {
            indicator.classList.add('hidden');
            hideTeacherTools();
          }
        }
      }
    }

    // Show/Hide teacher tools
    function showTeacherTools() {
      document.getElementById('scheduleTeacherTools').classList.remove('hidden');
      document.getElementById('homeworkTeacherTools').classList.remove('hidden');
      document.getElementById('materialsTeacherTools').classList.remove('hidden');
      document.getElementById('quizzesTeacherTools').classList.remove('hidden');
    }

    function hideTeacherTools() {
      document.getElementById('scheduleTeacherTools').classList.add('hidden');
      document.getElementById('homeworkTeacherTools').classList.add('hidden');
      document.getElementById('materialsTeacherTools').classList.add('hidden');
      document.getElementById('quizzesTeacherTools').classList.add('hidden');
    }

    // Render all content
    function renderAllContent() {
      renderLessons();
      renderSchedule();
      renderHomework();
      renderMaterials();
      renderQuizzes();
    }

    // Load lessons from API
    async function loadLessons(){
      if(lessonsLoading) return;
      lessonsLoading = true;
      lessonsError = null;
      const grid = document.getElementById('lessonsGrid');
      grid.innerHTML = `<div class="col-span-full text-center py-10 text-gray-600">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­ØµØµ...</div>`;
      try {
  // Use grade-specific endpoint for 1st secondary
  const resp = await fetch('https://courses-nine-eta.vercel.app/api/lessons/grade/1st-secondary');
  const data = await resp.json();
  lessons = (data.data || data.lessons || []).map(l=>{ if(!l.id && l._id) l.id = l._id; return l; });
        renderLessons();
      } catch(e){
        lessonsError = e;
        console.error('Load lessons error:', e);
        grid.innerHTML = `<div class='col-span-full text-center py-10 text-red-600'>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­ØµØµ <button class='underline' onclick='loadLessons()'>Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button></div>`;
      } finally {
        lessonsLoading = false;
      }
    }

    // Render lesson cards (dynamic)
    function renderLessons(){
      const grid = document.getElementById('lessonsGrid');
      if(!lessons || lessons.length === 0){
        grid.innerHTML = `<div class='col-span-full text-center py-10 text-gray-500'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­ØµØµ Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>`;
        return;
      }
      grid.innerHTML = '';
      lessons.forEach(l => grid.appendChild(createLessonCard(l)));
    }

    // Load schedules from API
    async function loadSchedules() {
      try {
        const token = localStorage.getItem('authToken') || '';
        const response = await fetch('https://courses-nine-eta.vercel.app/api/schedule/grade/1st-secondary', {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          schedules = (data.data || data.schedules || []).map(s => {
            if (!s.id && s._id) s.id = s._id;
            return s;
          });
          renderSchedule();
        } else {
          console.error('Failed to load schedules');
          renderSchedule(); // Render empty state
        }
      } catch (error) {
        console.error('Schedule load error:', error);
        renderSchedule(); // Render empty state
      }
    }

    // Load homework from API
    async function loadHomework() {
      if (homeworkLoading) return;
      homeworkLoading = true;
      homeworkError = null;
      renderHomework(); // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
      
      try {
        const token = localStorage.getItem('authToken') || '';
        const response = await fetch('https://courses-nine-eta.vercel.app/api/tasks/grade/first-secondary', {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          homework = data.data || [];
        } else {
          console.error('Failed to load homework:', response.statusText);
          homeworkError = new Error('Failed to load homework');
        }
      } catch (error) {
        console.error('Load homework error:', error);
        homeworkError = error;
      } finally {
        homeworkLoading = false;
        renderHomework(); // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
      }
    }

    // Create lesson card
    function createLessonCard(lesson){
      const card = document.createElement('div');
      card.className = 'subject-card bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500 relative flex flex-col';
      const canManage = window.LessonsAPI && LessonsAPI.canManage();
      // Backend might return lessonTitle/unitTitle instead of title/unit
  const lessonTitle = lesson.lessonTitle || lesson.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†';
  const lessonUnit = lesson.unitTitle || lesson.unit || '';
  // description not required per schema provided; keep fallback if exists
  const lessonDescription = lesson.lessonDescription || lesson.description || '';
      const videoUrl = lesson.videoUrl || lesson.video || lesson.video_link;
      card.innerHTML = `
        ${canManage ? '<div class="teacher-mode-indicator">Ù…Ø¯Ø±Ø³</div>' : ''}
        <div class="flex justify-between items-start mb-2">
          <div class="pr-1">
            <h3 class="text-lg font-bold text-blue-800 mb-1 line-clamp-2">${lessonTitle}</h3>
            ${lessonDescription ? `<p class=\"text-gray-700 text-sm mb-2 line-clamp-3\">${lessonDescription}</p>`:''}
            ${lessonUnit ? `<span class='inline-block text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full'>${lessonUnit}</span>`:''}
          </div>
          ${canManage ? `
            <div class='relative'>
              <button class='text-gray-500 hover:text-gray-700' onclick="this.nextElementSibling.classList.toggle('hidden')">â‹®</button>
              <div class='hidden absolute left-0 mt-1 w-32 bg-white border rounded shadow z-10'>
                <button class='block w-full text-right px-3 py-1 text-sm hover:bg-gray-100' onclick='openLessonModal("${lesson.id}")'>âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                <button class='block w-full text-right px-3 py-1 text-sm text-red-600 hover:bg-red-100' onclick='deleteLessonConfirm("${lesson.id}")'>ğŸ—‘ï¸ Ø­Ø°Ù</button>
              </div>
            </div>`:''}
        </div>
        <div class='mt-auto pt-2'>
          ${videoUrl ? `<button onclick='openLessonDetail("${lesson.id}")' class='w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2'>â–¶ï¸ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¯Ø±Ø³</button>` : `<div class='w-full bg-gray-300 text-gray-600 px-4 py-2 rounded-lg text-center text-sm'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ</div>`}
        </div>
      `;
      return card;
    }

    function openLessonDetail(id){
      window.location.href = `lesson.html?id=${encodeURIComponent(id)}`;
    }

    // ===== Toolbar & Modal Logic =====
    let editingLessonId = null;

    function setupLessonsToolbar(){
      const toolbar = document.getElementById('lessonsToolbar');
      if(!toolbar) return;
      const canManage = window.LessonsAPI && LessonsAPI.canManage();
      toolbar.innerHTML = `
        <div class='flex flex-col md:flex-row gap-3'>
          <div class='flex-1 flex items-stretch gap-2'>
            <input id='lessonSearch' type='text' placeholder='ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø­ØµØ©...' class='flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm' />
            <select id='lessonUnitFilter' class='px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm'>
              <option value=''>ÙƒÙ„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª</option>
            </select>
          </div>
          ${canManage ? `<a href='add-lesson.html' class='px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm flex items-center gap-2 self-start'>â• Ø¥Ø¶Ø§ÙØ© Ø­ØµØ©</a>`:''}
        </div>`;

      const searchInput = document.getElementById('lessonSearch');
      let searchDebounce;
      searchInput.addEventListener('input', e => {
        clearTimeout(searchDebounce);
        searchDebounce = setTimeout(()=>{
          currentLessonSearch = e.target.value.trim();
          currentLessonPage = 1;
          loadLessons();
        }, 350);
      });

      document.getElementById('lessonUnitFilter').addEventListener('change', e => {
        currentLessonUnit = e.target.value;
        currentLessonPage = 1;
        loadLessons();
      });

      // ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ ØµÙØ­Ø© add-lesson.html ÙˆØ¨Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø­Ø¯Ø« Ø²Ø± Ù…Ø­Ù„ÙŠ
    }

    // If page loaded before user was ready, rebuild toolbar when user becomes available
    document.addEventListener('auth:user-ready', () => {
      // Only rebuild if button is missing and user can manage
      if(window.LessonsAPI && LessonsAPI.canManage()){
        const btn = document.getElementById('addLessonBtn');
        if(!btn){
          setupLessonsToolbar();
        }
      }
    });

    function refreshUnitFilter(){
      const select = document.getElementById('lessonUnitFilter');
      if(!select) return;
      const units = Array.from(new Set(lessons.map(l=>l.unit).filter(Boolean)));
      const current = select.value;
      select.innerHTML = `<option value=''>ÙƒÙ„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª</option>` + units.map(u=>`<option value='${u}' ${u===current?'selected':''}>${u}</option>`).join('');
    }

    function openLessonModal(){ window.location.href='add-lesson.html'; }
    function closeLessonModal(){}

    async function submitLessonForm(e){
      e.preventDefault();
      if(!(window.LessonsAPI && LessonsAPI.canManage())){ showNotification('Ù„ÙŠØ³Øª Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª', 'error'); return; }
      const form = e.target;
      // Map to backend expected field names
      const data = {
        grade: form.grade.value,
        unitTitle: form.unitTitle.value.trim(),
        lessonTitle: form.lessonTitle.value.trim(),
        videoUrl: form.videoUrl.value.trim(),
        createdBy: (function(){
          try {
            const u = (window.AUTH && window.AUTH.getCurrentUser) ? window.AUTH.getCurrentUser() : null;
            return u ? (u._id || u.id || u.userId) : undefined;
          } catch(e){ return undefined; }
        })()
      };
      if(!data.grade){ showNotification('Ø§Ù„ØµÙ Ù…Ø·Ù„ÙˆØ¨', 'error'); return; }
      if(!data.unitTitle){ showNotification('Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ­Ø¯Ø© Ù…Ø·Ù„ÙˆØ¨', 'error'); return; }
      if(!data.lessonTitle){ showNotification('Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³ Ù…Ø·Ù„ÙˆØ¨', 'error'); return; }
      if(!data.videoUrl){ showNotification('Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø·Ù„ÙˆØ¨', 'error'); return; }
      const saveBtn = document.getElementById('lessonSaveBtn');
      saveBtn.disabled = true; saveBtn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
      try {
        if(editingLessonId){
          await LessonsAPI.updateLesson(editingLessonId, data);
          showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­ØµØ©', 'success');
        } else {
          await LessonsAPI.createLesson(data);
          showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­ØµØ©', 'success');
        }
        closeLessonModal();
        await loadLessons();
        refreshUnitFilter();
      } catch(err){
        console.error(err);
        if(err && err.body && Array.isArray(err.body.errors)){
          const first = err.body.errors[0];
          const msg = first && first.msg ? first.msg : 'ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø­ØµØ©';
          showNotification(msg, 'error');
        } else {
          showNotification('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø­ØµØ©', 'error');
        }
      } finally {
        saveBtn.disabled = false; saveBtn.textContent = 'ğŸ’¾ Ø­ÙØ¸';
      }
    }

    async function deleteLessonConfirm(id){
      if(!confirm('Ø­Ø°Ù Ø§Ù„Ø­ØµØ© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) return;
      try {
        await LessonsAPI.deleteLesson(id);
        showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­ØµØ©', 'success');
        loadLessons();
      } catch(e){
        showNotification('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø­ØµØ©', 'error');
      }
    }

    // Render schedule
    function renderSchedule() {
      const scheduleGrid = document.getElementById('scheduleGrid');
      
      // Use API data or show empty state
      if (!schedules || schedules.length === 0) {
        scheduleGrid.innerHTML = `<div class="col-span-full text-center py-10 text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ø¯Ø§ÙˆÙ„ Ø¯Ø±Ø§Ø³ÙŠØ© Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>`;
        return;
      }
      
      scheduleGrid.innerHTML = '';
      
      // Group by day
      const groupedByDay = schedules.reduce((acc, item) => {
        if (!acc[item.day]) acc[item.day] = [];
        acc[item.day].push(item);
        return acc;
      }, {});
      
      Object.keys(groupedByDay).forEach(day => {
        const dayCard = document.createElement('div');
        dayCard.className = 'bg-white rounded-xl shadow-lg overflow-hidden';
        
        let dayContent = `
          <div class="schedule-time px-4 py-3 text-white text-center">
            <h3 class="font-bold text-lg">${day}</h3>
          </div>
          <div class="p-4 space-y-3">
        `;
        
        groupedByDay[day].forEach(item => {
          const canManage = window.LessonsAPI && LessonsAPI.canManage();
          const timeFrom = item.timeFrom || item.startTime || '';
          const timeTo = item.timeTo || item.endTime || '';
          const scheduleId = item.id || item._id;
          
          dayContent += `
            <div class="schedule-card bg-blue-50 border-l-4 border-blue-400 p-3 rounded-lg relative">
              ${canManage ? '<div class="teacher-mode-indicator">Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</div>' : ''}
              <div class="flex justify-between items-start">
                <div class="flex-1">
                  <span class="font-semibold text-blue-800">${item.subject}</span>
                  <div class="text-sm text-blue-600 mt-1">${timeFrom} - ${timeTo}</div>
                  ${item.date ? `<div class="text-xs text-gray-500 mt-1">${new Date(item.date).toLocaleDateString('ar-EG')}</div>` : ''}
                </div>
                ${canManage ? `
                  <div class="relative">
                    <button class="text-gray-500 hover:text-gray-700" onclick="this.nextElementSibling.classList.toggle('hidden')">â‹®</button>
                    <div class="hidden absolute left-0 mt-1 w-32 bg-white border rounded shadow z-10">
                      <button class="block w-full text-right px-3 py-1 text-sm hover:bg-gray-100" onclick="editScheduleItem('${scheduleId}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                      <button class="block w-full text-right px-3 py-1 text-sm text-red-600 hover:bg-red-100" onclick="deleteScheduleItem('${scheduleId}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </div>
                  </div>
                ` : ''}
              </div>
            </div>
          `;
        });
        
        dayContent += '</div>';
        dayCard.innerHTML = dayContent;
        scheduleGrid.appendChild(dayCard);
      });
    }

    // Render homework
    function renderHomework() {
      const homeworkGrid = document.getElementById('homeworkGrid');
      
      if (homeworkLoading) {
        homeworkGrid.innerHTML = '<div class="col-span-full text-center py-10 text-gray-600">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª...</div>';
        return;
      }
      
      if (homeworkError) {
        homeworkGrid.innerHTML = '<div class="col-span-full text-center py-10 text-red-600">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª <button class="underline" onclick="loadHomework()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button></div>';
        return;
      }
      
      if (homework.length === 0) {
        homeworkGrid.innerHTML = '<div class="col-span-full text-center py-10 text-gray-600">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ§Ø¬Ø¨Ø§Øª Ù…ØªØ§Ø­Ø©</div>';
        return;
      }
      
      homeworkGrid.innerHTML = '';
      
      homework.forEach((item) => {
        const homeworkCard = document.createElement('div');
        homeworkCard.className = 'homework-card bg-white rounded-xl shadow-lg p-6 border-blue-400 relative';
        
        // Calculate days until due
        const dueDate = new Date(item.dueDate);
        const today = new Date();
        const diffTime = dueDate - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        let statusText = 'Ù…Ù†ØªÙ‡ÙŠ';
        let statusColor = 'bg-red-100 text-red-800';
        
        if (diffDays > 7) {
          statusText = 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¯Ù…';
          statusColor = 'bg-blue-100 text-blue-800';
        } else if (diffDays > 1) {
          statusText = `Ø¨Ø¹Ø¯ ${diffDays} Ø£ÙŠØ§Ù…`;
          statusColor = 'bg-yellow-100 text-yellow-800';
        } else if (diffDays === 1) {
          statusText = 'ØºØ¯Ø§Ù‹';
          statusColor = 'bg-orange-100 text-orange-800';
        } else if (diffDays === 0) {
          statusText = 'Ø§Ù„ÙŠÙˆÙ…';
          statusColor = 'bg-red-100 text-red-800';
        }
        
        // Priority colors
        let priorityColor = 'border-blue-400';
        if (item.priority === 'Ø¹Ø§Ø¬Ù„') priorityColor = 'border-red-400';
        else if (item.priority === 'Ø¹Ø§Ù„ÙŠ') priorityColor = 'border-orange-400';
        else if (item.priority === 'Ù…ØªÙˆØ³Ø·') priorityColor = 'border-yellow-400';
        
        homeworkCard.className = `homework-card bg-white rounded-xl shadow-lg p-6 ${priorityColor} relative`;
        
        homeworkCard.innerHTML = `
          ${isTeacherMode ? '<div class="teacher-mode-indicator">Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</div>' : ''}
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg md:text-xl font-bold text-blue-800">${item.subject}</h3>
            <span class="px-3 py-1 ${statusColor} rounded-full text-sm">${statusText}</span>
          </div>
          <h4 class="text-md font-semibold text-gray-800 mb-2">${item.title}</h4>
          <p class="text-gray-700 mb-4">${item.description}</p>
          <div class="flex justify-between items-center text-sm text-gray-600 mb-4">
            <span>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…: ${new Date(item.dueDate).toLocaleDateString('ar-EG')}</span>
            <span class="px-2 py-1 bg-gray-100 rounded">${item.priority}</span>
          </div>
          ${item.attachments && item.attachments.length > 0 ? `
            <div class="mb-4">
              <h5 class="text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª:</h5>
              ${item.attachments.map(att => `
                <a href="${att.url}" target="_blank" class="text-blue-600 hover:text-blue-800 text-sm block">
                  <i class="fas fa-paperclip ml-1"></i> ${att.filename}
                </a>
              `).join('')}
            </div>
          ` : ''}
          ${isTeacherMode ? `
            <div class="teacher-tools rounded-lg p-3">
              <button 
                onclick="editHomework('${item._id || item.id}')"
                class="px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm ml-2"
              >
                âœï¸ ØªØ¹Ø¯ÙŠÙ„
              </button>
              <button 
                onclick="deleteHomework('${item._id || item.id}')"
                class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm"
              >
                ğŸ—‘ï¸ Ø­Ø°Ù
              </button>
            </div>
          ` : ''}
        `;
        
        homeworkGrid.appendChild(homeworkCard);
      });
    }

    // Render materials
    function renderMaterials() {
      const materialsGrid = document.getElementById('materialsGrid');
      const materials = JSON.parse(localStorage.getItem('materials_grade1') || '[]');
      
      // Default materials if empty
      if (materials.length === 0) {
        materials.push({
          title: 'Ù…Ù„Ø®Øµ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª',
          description: 'Ø¬Ø¨Ø± ÙˆÙ‡Ù†Ø¯Ø³Ø©',
          files: [
            { name: 'ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø¬Ø¨Ø±.pdf', link: '#' },
            { name: 'Ù…Ø³Ø§Ø¦Ù„ Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©.pdf', link: '#' }
          ]
        });
      }
      
      materialsGrid.innerHTML = '';
      
      materials.forEach((material, index) => {
        const materialCard = document.createElement('div');
        materialCard.className = 'pdf-card bg-white rounded-xl shadow-lg p-6 relative';
        
        let filesHtml = '';
        material.files.forEach((file, fileIndex) => {
          filesHtml += `
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
              <span class="text-sm">${file.name}</span>
              <div class="flex gap-2">
                <button onclick="downloadFile('${file.link}')" class="text-blue-600 hover:text-blue-800"><i class="fas fa-download"></i></button>
                ${isTeacherMode ? `
                  <button onclick="removeMaterialFile(${index}, ${fileIndex})" class="text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button>
                ` : ''}
              </div>
            </div>
          `;
        });
        
        materialCard.innerHTML = `
          ${isTeacherMode ? '<div class="teacher-mode-indicator">Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</div>' : ''}
          <div class="text-center mb-4">
            <i class="fas fa-file-pdf text-red-500 text-4xl mb-2"></i>
            <h3 class="font-bold text-gray-800">${material.title}</h3>
            <p class="text-sm text-gray-600">${material.description}</p>
          </div>
          <div class="space-y-2">
            ${filesHtml}
          </div>
          ${isTeacherMode ? `
            <div class="teacher-tools rounded-lg p-3 mt-4">
              <button 
                onclick="removeMaterial(${index})"
                class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm"
              >
                ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
              </button>
            </div>
          ` : ''}
        `;
        
        materialsGrid.appendChild(materialCard);
      });
    }

    // Render quizzes
    function renderQuizzes() {
      const quizzesGrid = document.getElementById('quizzesGrid');
      const quizzes = JSON.parse(localStorage.getItem('quizzes_grade1') || '[]');
      
      // Default quizzes if empty
      if (quizzes.length === 0) {
        quizzes.push({
          title: 'ÙƒÙˆÙŠØ² Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰',
          description: '10 Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„Ø¬Ø¨Ø±',
          status: 'Ù…ØªØ§Ø­'
        });
      }
      
      quizzesGrid.innerHTML = '';
      
      quizzes.forEach((quiz, index) => {
        const quizCard = document.createElement('div');
        quizCard.className = 'quiz-card bg-white rounded-xl shadow-lg p-6 border-yellow-400 relative';
        
        const statusColors = {
          'Ù…ØªØ§Ø­': 'bg-yellow-100 text-yellow-800',
          'Ù‚Ø±ÙŠØ¨Ø§Ù‹': 'bg-blue-100 text-blue-800',
          'Ù…ØºÙ„Ù‚': 'bg-red-100 text-red-800'
        };
        
        quizCard.innerHTML = `
          ${isTeacherMode ? '<div class="teacher-mode-indicator">Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</div>' : ''}
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg md:text-xl font-bold text-yellow-800">${quiz.title}</h3>
            <span class="px-3 py-1 ${statusColors[quiz.status]} rounded-full text-sm">${quiz.status}</span>
          </div>
          <p class="text-gray-700 mb-4">${quiz.description}</p>
          <div class="flex justify-between items-center">
            ${quiz.status === 'Ù…ØªØ§Ø­' ? `
              <button class="bg-yellow-500 text-white px-4 py-2 rounded-lg shadow hover:bg-yellow-600 flex-1">Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙƒÙˆÙŠØ²</button>
            ` : `
              <button disabled class="bg-gray-400 text-white px-4 py-2 rounded-lg shadow cursor-not-allowed flex-1">${quiz.status}</button>
            `}
            ${isTeacherMode ? `
              <button 
                onclick="removeQuiz(${index})"
                class="mr-2 px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm"
              >
                ğŸ—‘ï¸
              </button>
            ` : ''}
          </div>
        `;
        
        quizzesGrid.appendChild(quizCard);
      });
    }

    // Add functions for teacher tools
    function addScheduleItem() {
      const day = document.getElementById('scheduleDay').value.trim();
      const subject = document.getElementById('scheduleSubject').value.trim();
      const startTime = document.getElementById('scheduleTimeStart').value;
      const endTime = document.getElementById('scheduleTimeEnd').value;
      
      if (!day || !subject || !startTime || !endTime) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
        return;
      }
      
      const scheduleItems = JSON.parse(localStorage.getItem('scheduleItems_grade1') || '[]');
      scheduleItems.push({ day, subject, startTime, endTime });
      localStorage.setItem('scheduleItems_grade1', JSON.stringify(scheduleItems));
      
      // Clear inputs
      document.getElementById('scheduleDay').value = '';
      document.getElementById('scheduleSubject').value = '';
      document.getElementById('scheduleTimeStart').value = '';
      document.getElementById('scheduleTimeEnd').value = '';
      
      renderSchedule();
      showNotification('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }

    function removeScheduleItem(day, index) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©ØŸ')) return;
      
      const scheduleItems = JSON.parse(localStorage.getItem('scheduleItems_grade1') || '[]');
      const filteredItems = scheduleItems.filter(item => item.day !== day || scheduleItems.indexOf(item) !== scheduleItems.findIndex(i => i.day === day) + index);
      localStorage.setItem('scheduleItems_grade1', JSON.stringify(filteredItems));
      
      renderSchedule();
      showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }

    function addHomework() {
      const subject = document.getElementById('homeworkSubject').value.trim();
      const description = document.getElementById('homeworkDescription').value.trim();
      const dueDate = document.getElementById('homeworkDueDate').value;
      
      if (!subject || !description || !dueDate) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
        return;
      }
      
      const homeworkItems = JSON.parse(localStorage.getItem('homeworkItems_grade1') || '[]');
      const today = new Date();
      const due = new Date(dueDate);
      const diffDays = Math.ceil((due - today) / (1000 * 60 * 60 * 24));
      
      let status = 'Ù…ØªØ£Ø®Ø±';
      if (diffDays === 1) status = 'ØºØ¯Ø§Ù‹';
      else if (diffDays <= 7 && diffDays > 1) status = 'Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹';
      else if (diffDays > 7) status = 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¯Ù…';
      
      homeworkItems.push({ subject, description, dueDate, status });
      localStorage.setItem('homeworkItems_grade1', JSON.stringify(homeworkItems));
      
      // Clear inputs
      document.getElementById('homeworkSubject').value = '';
      document.getElementById('homeworkDescription').value = '';
      document.getElementById('homeworkDueDate').value = '';
      
      renderHomework();
      showNotification('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }

    // Edit homework
    async function editHomework(homeworkId) {
      // Redirect to add-homework.html with edit mode
      window.location.href = `add-homework.html?edit=${encodeURIComponent(homeworkId)}`;
    }

    // Delete homework
    async function deleteHomework(homeworkId) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙˆØ§Ø¬Ø¨ØŸ')) return;
      
      try {
        const token = localStorage.getItem('authToken') || '';
        const response = await fetch(`https://courses-nine-eta.vercel.app/api/tasks/${homeworkId}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
          loadHomework(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª
        } else {
          const errorData = await response.json();
          throw new Error(errorData.message || 'ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙˆØ§Ø¬Ø¨');
        }
      } catch (error) {
        console.error('Delete homework error:', error);
        showNotification(error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ÙˆØ§Ø¬Ø¨', 'error');
      }
    }

    function addMaterial() {
      const title = document.getElementById('materialTitle').value.trim();
      const description = document.getElementById('materialDescription').value.trim();
      const link = document.getElementById('materialLink').value.trim();
      
      if (!title || !description || !link) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
        return;
      }
      
      const materials = JSON.parse(localStorage.getItem('materials_grade1') || '[]');
      const fileName = title + '.pdf';
      
      materials.push({
        title,
        description,
        files: [{ name: fileName, link }]
      });
      
      localStorage.setItem('materials_grade1', JSON.stringify(materials));
      
      // Clear inputs
      document.getElementById('materialTitle').value = '';
      document.getElementById('materialDescription').value = '';
      document.getElementById('materialLink').value = '';
      
      renderMaterials();
      showNotification('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }

    function removeMaterial(index) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø©ØŸ')) return;
      
      const materials = JSON.parse(localStorage.getItem('materials_grade1') || '[]');
      materials.splice(index, 1);
      localStorage.setItem('materials_grade1', JSON.stringify(materials));
      
      renderMaterials();
      showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }

    function addQuiz() {
      const title = document.getElementById('quizTitle').value.trim();
      const description = document.getElementById('quizDescription').value.trim();
      const status = document.getElementById('quizStatus').value;
      
      if (!title || !description) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
        return;
      }
      
      const quizzes = JSON.parse(localStorage.getItem('quizzes_grade1') || '[]');
      quizzes.push({ title, description, status });
      localStorage.setItem('quizzes_grade1', JSON.stringify(quizzes));
      
      // Clear inputs
      document.getElementById('quizTitle').value = '';
      document.getElementById('quizDescription').value = '';
      document.getElementById('quizStatus').value = 'available';
      
      renderQuizzes();
      showNotification('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆÙŠØ² Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }

    function removeQuiz(index) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆÙŠØ²ØŸ')) return;
      
      const quizzes = JSON.parse(localStorage.getItem('quizzes_grade1') || '[]');
      quizzes.splice(index, 1);
      localStorage.setItem('quizzes_grade1', JSON.stringify(quizzes));
      
      renderQuizzes();
      showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙˆÙŠØ² Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }

    function downloadFile(link) {
      window.open(link, '_blank');
    }

    function isValidYouTubeUrl(url) {
      const youtubeRegex = /^(https?:\/\/)?(www\.)?(youtube\.com\/(watch\?v=|embed\/)|youtu\.be\/).+/;
      return youtubeRegex.test(url);
    }

    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300 ${
        type === 'success' ? 'bg-green-600 text-white' : 
        type === 'error' ? 'bg-red-600 text-white' : 
        'bg-blue-600 text-white'
      }`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }

    // Theme toggle
    const toggleBtn = document.getElementById("themeToggle");
    toggleBtn.addEventListener("click", () => {
      document.documentElement.classList.toggle("dark");
      toggleBtn.textContent = document.documentElement.classList.contains("dark") ? "â˜€ï¸" : "ğŸŒ™";
    });

    // User menu
    const userBtn = document.getElementById("userMenuBtn");
    const userMenu = document.getElementById("userMenu");
    userBtn.addEventListener("click", () => {
      userMenu.classList.toggle("hidden");
    });

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("studentName");
      localStorage.removeItem("globalTeacherMode");
      window.location.href = "index_updated.html";
    });
    document.getElementById("logoutBtn2").addEventListener("click", () => {
      localStorage.removeItem("studentName");
      localStorage.removeItem("globalTeacherMode");
      window.location.href = "index_updated.html";
    });

    // Schedule Management Functions
    let editingScheduleId = null;

    function openAddScheduleModal() {
      editingScheduleId = null;
      document.getElementById('scheduleModalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø§Ø³ÙŠ';
      document.getElementById('scheduleForm').reset();
      document.getElementById('scheduleModal').classList.remove('hidden');
    }

    function closeScheduleModal() {
      document.getElementById('scheduleModal').classList.add('hidden');
      editingScheduleId = null;
    }

    async function saveSchedule(event) {
      event.preventDefault();
      
      const day = document.getElementById('scheduleDay').value;
      const subject = document.getElementById('scheduleSubject').value;
      const grade = document.getElementById('scheduleGrade').value;
      const date = document.getElementById('scheduleDate').value;
      const timeFrom = document.getElementById('scheduleTimeFrom').value;
      const timeTo = document.getElementById('scheduleTimeTo').value;
      
      // Get current user data and teacher ID
      let teacherId = null;
      try {
        const userStr = localStorage.getItem('currentUser') || 
                       localStorage.getItem('user') || 
                       localStorage.getItem('userData');
        
        if (userStr) {
          const user = JSON.parse(userStr);
          teacherId = user.id || user.userId || user._id || user.teacherId;
          console.log('Teacher ID:', teacherId);
        }
      } catch (e) {
        console.warn('Failed to get teacher ID:', e);
      }

      const scheduleData = {
        day,
        subject,
        grade,
        date,
        timeFrom,
        timeTo,
        instructor: teacherId // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø¹Ù„Ù…
      };
      
      try {
        const token = localStorage.getItem('authToken') || '';
        const url = editingScheduleId 
          ? `https://courses-nine-eta.vercel.app/api/schedule/${editingScheduleId}`
          : 'https://courses-nine-eta.vercel.app/api/schedule';
        
        const method = editingScheduleId ? 'PUT' : 'POST';
        
        const response = await fetch(url, {
          method,
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(scheduleData)
        });
        
        if (response.ok) {
          showNotification(editingScheduleId ? 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­' : 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
          closeScheduleModal();
          loadSchedules();
        } else {
          const error = await response.json();
          showNotification(error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„', 'error');
        }
      } catch (error) {
        console.error('Schedule save error:', error);
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
      }
    }

    async function editScheduleItem(scheduleId) {
      const schedule = schedules.find(s => (s.id || s._id) === scheduleId);
      if (!schedule) return;
      
      editingScheduleId = scheduleId;
      document.getElementById('scheduleModalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ';
      
      document.getElementById('scheduleDay').value = schedule.day || '';
      document.getElementById('scheduleSubject').value = schedule.subject || '';
      document.getElementById('scheduleGrade').value = schedule.grade || '';
      document.getElementById('scheduleDate').value = schedule.date ? new Date(schedule.date).toISOString().split('T')[0] : '';
      document.getElementById('scheduleTimeFrom').value = schedule.timeFrom || '';
      document.getElementById('scheduleTimeTo').value = schedule.timeTo || '';
      
      document.getElementById('scheduleModal').classList.remove('hidden');
    }

    async function deleteScheduleItem(scheduleId) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØŸ')) return;
      
      try {
        const token = localStorage.getItem('authToken') || '';
        const response = await fetch(`https://courses-nine-eta.vercel.app/api/schedule/${scheduleId}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
          loadSchedules();
        } else {
          const error = await response.json();
          showNotification(error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø¬Ø¯ÙˆÙ„', 'error');
        }
      } catch (error) {
        console.error('Schedule delete error:', error);
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
      }
    }

    function showNotification(message, type = 'success') {
      // Remove any existing notifications
      const existingNotification = document.querySelector('.notification');
      if (existingNotification) {
        existingNotification.remove();
      }
      
      // Create new notification
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      
      // Add to page
      document.body.appendChild(notification);
      
      // Show notification
      setTimeout(() => {
        notification.classList.add('show');
      }, 100);
      
      // Hide and remove notification after 4 seconds
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 4000);
    }
  </script>
  
  <!-- Teacher Mode Auto System -->
  <script src="../js/teacher-mode.js"></script>
  
  <!-- Schedule Management Modal -->
  <div id="scheduleModal" class="modal hidden">
    <div class="modal-content">
      <h3 id="scheduleModalTitle">Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø§Ø³ÙŠ</h3>
      <form id="scheduleForm" onsubmit="saveSchedule(event)">
        <div class="form-group">
          <label for="scheduleDay">Ø§Ù„ÙŠÙˆÙ…:</label>
          <select id="scheduleDay" required>
            <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙŠÙˆÙ…</option>
            <option value="Ø§Ù„Ø£Ø­Ø¯">Ø§Ù„Ø£Ø­Ø¯</option>
            <option value="Ø§Ù„Ø§Ø«Ù†ÙŠÙ†">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option>
            <option value="Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
            <option value="Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
            <option value="Ø§Ù„Ø®Ù…ÙŠØ³">Ø§Ù„Ø®Ù…ÙŠØ³</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="scheduleSubject">Ø§Ù„Ù…Ø§Ø¯Ø©:</label>
          <input type="text" id="scheduleSubject" required placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª">
        </div>
        
        <div class="form-group">
          <label for="scheduleGrade">Ø§Ù„ØµÙ:</label>
          <select id="scheduleGrade" required>
            <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
            <option value="Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
            <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ Ø¹Ù„Ù…ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ Ø¹Ù„Ù…ÙŠ</option>
            <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ Ø§Ø¯Ø¨ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ Ø§Ø¯Ø¨ÙŠ</option>
            <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ Ø¹Ù„Ù…ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ Ø¹Ù„Ù…ÙŠ</option>
            <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ Ø§Ø¯Ø¨ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ Ø§Ø¯Ø¨ÙŠ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="scheduleDate">Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
          <input type="date" id="scheduleDate" required>
        </div>
        
        <div class="form-group">
          <label for="scheduleTimeFrom">Ø§Ù„ÙˆÙ‚Øª Ù…Ù†:</label>
          <input type="time" id="scheduleTimeFrom" required>
        </div>
        
        <div class="form-group">
          <label for="scheduleTimeTo">Ø§Ù„ÙˆÙ‚Øª Ø¥Ù„Ù‰:</label>
          <input type="time" id="scheduleTimeTo" required>
        </div>
        
        <div class="form-buttons">
          <button type="submit" class="btn btn-primary">Ø­ÙØ¸</button>
          <button type="button" onclick="closeScheduleModal()" class="btn btn-secondary">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­ØµØ© - Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¢Ù† Ø¹Ø¨Ø± add-lesson.html -->
</body>
</html>