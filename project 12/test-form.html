<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            direction: rtl;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 300px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h1>
    
    <form id="testForm">
        <div class="form-group">
            <label for="fullName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ:</label>
            <input type="text" id="fullName" name="fullName" required>
        </div>
        
        <div class="form-group">
            <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
            <input type="email" id="email" name="email" required>
        </div>
        
        <div class="form-group">
            <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
            <input type="password" id="password" name="password" required>
        </div>
        
        <div class="form-group">
            <label for="location">Ø§Ù„Ù…ÙƒØ§Ù†:</label>
            <select id="location" name="location" required>
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙƒØ§Ù†</option>
                <option value="Ø§Ù„Ø¹Ø³ÙŠØ±Ø§Øª">Ø§Ù„Ø¹Ø³ÙŠØ±Ø§Øª</option>
                <option value="Ø§Ù„Ù…Ù†Ø´Ø§Ø©">Ø§Ù„Ù…Ù†Ø´Ø§Ø©</option>
                <option value="Ø§Ù„Ø§Ø¬Ø§ÙŠÙˆÙ‡">Ø§Ù„Ø§Ø¬Ø§ÙŠÙˆÙ‡</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="grade">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ:</label>
            <select id="grade" name="grade" required>
                <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ Ø¹Ù„Ù…ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ Ø¹Ù„Ù…ÙŠ</option>
                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ Ø§Ø¯Ø¨ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ Ø§Ø¯Ø¨ÙŠ</option>
                <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
            <input type="tel" id="phone" name="phone">
        </div>
        
        <button type="submit">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
    </form>
    
    <div id="result" class="result" style="display: none;"></div>
    
    <script>
        const API_BASE_URL = 'http://localhost:3000/api';
        
        // Split full name into parts
        function splitFullName(fullName) {
            const names = fullName.trim().split(/\s+/);
            return {
                firstName: names[0] || '',
                secondName: names[1] || '',
                thirdName: names[2] || '',
                fourthName: names[3] || names[2] // If only 3 names, use third as fourth
            };
        }
        
        document.getElementById('testForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            
            // Log all form data
            console.log('=== Form Data ===');
            for (let pair of formData.entries()) {
                console.log(`${pair[0]}: ${pair[1]}`);
            }
            
            const fullName = formData.get('fullName');
            const nameParts = splitFullName(fullName);
            
            const userData = {
                firstName: nameParts.firstName,
                secondName: nameParts.secondName,
                thirdName: nameParts.thirdName,
                fourthName: nameParts.fourthName,
                email: formData.get('email'),
                password: formData.get('password'),
                location: formData.get('location'),
                grade: formData.get('grade'),
                role: 'student',
                phone: formData.get('phone') || undefined
            };
            
            console.log('=== User Data to Send ===');
            console.log(JSON.stringify(userData, null, 2));
            
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            
            try {
                const response = await fetch(`${API_BASE_URL}/users/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });
                
                console.log('Response Status:', response.status);
                
                const result = await response.json();
                console.log('Response Data:', result);
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h3>Ù†Ø¬Ø­ Ø§Ù„ØªØ³Ø¬ÙŠÙ„! âœ…</h3>
                        <p>Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${result.message}</p>
                        <p>Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${result.user._id}</p>
                        <p>Ø§Ù„Ø§Ø³Ù…: ${result.user.name}</p>
                        <p>Ø§Ù„Ø¨Ø±ÙŠØ¯: ${result.user.email}</p>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        <h3>ÙØ´Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„! âŒ</h3>
                        <p>Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${result.message}</p>
                        ${result.errors ? '<p>Ø§Ù„Ø£Ø®Ø·Ø§Ø¡: ' + result.errors.map(e => e.msg).join(', ') + '</p>' : ''}
                    `;
                }
                
            } catch (error) {
                console.error('Error:', error);
                resultDiv.className = 'result error';
                
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    resultDiv.innerHTML = `
                        <h3>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„! ğŸš«</h3>
                        <p>Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</p>
                        <p>ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ Ø¹Ù„Ù‰: ${API_BASE_URL}</p>
                        <p>Ø§Ù„Ø®Ø·Ø£: ${error.message}</p>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <h3>Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹! âš ï¸</h3>
                        <p>${error.message}</p>
                    `;
                }
            }
        });
        
        console.log('Test form loaded and ready!');
    </script>
</body>
</html>